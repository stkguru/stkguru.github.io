const c=[.1,.2,.3,.4,.5,.6];function T(t,i){if(!t||!t.length)return{avg:[],plus2:[],minus2:[],pctLinesAbove:[],pctLinesBelow:[],pctPercents:c};const f=365.25*24*3600*1e3,n=[],u=[],g=[],d=c.map(()=>[]),L=c.map(()=>[]);for(let a=0;a<t.length;++a){const[e]=t[a],R=e-i*f;let h=0,m=a;for(;h<m;){const s=Math.floor((h+m)/2);t[s][0]>=R?m=s:h=s+1}const p=t.slice(h,a+1).map(([s,l])=>l);if(p.length>1){const s=p.reduce((o,r)=>o+r,0)/p.length,l=p.reduce((o,r)=>o+(r-s)**2,0)/p.length,E=Math.sqrt(l);n.push([e,s]),u.push([e,s+2*E]),g.push([e,s-2*E]),c.forEach((o,r)=>{d[r].push([e,s*(1+o)]),L[r].push([e,s*(1-o)])})}else n.push([e,null]),u.push([e,null]),g.push([e,null]),c.forEach((s,l)=>{d[l].push([e,null]),L[l].push([e,null])})}return{avg:n,plus2:u,minus2:g,pctLinesAbove:d,pctLinesBelow:L,pctPercents:c}}self.addEventListener("message",t=>{if(t.data.type==="CALCULATE_ROLLING_STATS"){const{peData:i,nYears:f}=t.data.data;try{const u={type:"ROLLING_STATS_RESULT",data:T(i,f)};self.postMessage(u)}catch(n){self.postMessage({type:"ERROR",error:n instanceof Error?n.message:"Unknown error"})}}});
