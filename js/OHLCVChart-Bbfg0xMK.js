import{r as m,j as a}from"./query-vendor-Du5i0pT7.js";import{H as A,E as Q,a as ee}from"./ErrorMessage-Cc20MXJj.js";import{L as te}from"./index-BBDFoHgB.js";import"./react-vendor-DJG_os-6.js";import"./charts-vendor-CIWdG-YD.js";const W=(C,v)=>{const E=[],b=2/(v+1);let k=0;for(let h=0;h<v&&h<C.length;h++)k+=C[h];E[v-1]=k/v;for(let h=v;h<C.length;h++)E[h]=C[h]*b+E[h-1]*(1-b);return E},ae=(C,v=10,E=20,b=5)=>{const k=W(C,v),h=W(C,E),_=[],y=[],L=[];for(let u=Math.max(v,E)-1;u<C.length;u++)_[u]=k[u]-h[u];const j=W(_.filter(u=>u!==void 0),b);let T=0;for(let u=Math.max(v,E)-1;u<C.length;u++)_[u]!==void 0&&(y[u]=j[T],L[u]=_[u]-y[u],T++);return{macdLine:_,signalLine:y,histogram:L}},ce=({autoRefresh:C=!1,refreshInterval:v=5*60*1e3,className:E=""})=>{const[b,k]=m.useState(""),[h,_]=m.useState([]),[y,L]=m.useState(""),[j,T]=m.useState("pop"),[u,Z]=m.useState([]),[N,z]=m.useState(!0),[R,O]=m.useState(null),[M,Y]=m.useState(null),P=m.useCallback(async()=>{try{z(!0),O(null),console.log("Fetching categorized tickers from /api/wedge_pop/stats.json");const t=await fetch("/api/wedge_pop/stats.json");if(console.log("Response status:",t.status),!t.ok)throw new Error(`Failed to fetch categorized tickers: ${t.status}`);const r=await t.json();console.log("Categorized tickers data:",r);const i=r.sort((d,D)=>{const S=new Date(d.date.substring(0,4)+"-"+d.date.substring(4,6)+"-"+d.date.substring(6,8));return new Date(D.date.substring(0,4)+"-"+D.date.substring(4,6)+"-"+D.date.substring(6,8)).getTime()-S.getTime()}).map(d=>({date:d.date,pop:d.pop,drop:d.drop,pop_pct:d.pop_pct,drop_pct:d.drop_pct}));if(_(i),console.log("Processed categorized tickers:",i),i.length>0){const d=i[0].date;L(d),i[0].pop.length>0?(k(i[0].pop[0]),T("pop")):i[0].drop.length>0&&(k(i[0].drop[0]),T("drop"))}}catch(t){console.error("Failed to fetch categorized tickers:",t),O("Failed to fetch categorized ticker list")}finally{z(!1)}},[]),H=m.useCallback(()=>{if(!y||!h.length)return[];const t=h.find(r=>r.date===y);return t?j==="pop"?t.pop:t.drop:[]},[y,j,h]),V=m.useCallback(async t=>{if(t)try{z(!0),O(null),console.log("Fetching OHLCV data for ticker:",t);const r=await fetch(`/api/ohlcvw/${t}.json`);if(console.log("OHLCV response status:",r.status),!r.ok)throw new Error(`Failed to fetch OHLCV data: ${r.status}`);const n=await r.json();console.log("OHLCV data:",n);let i=[];if(Array.isArray(n))i=n;else if(n&&typeof n=="object")if(n.data&&Array.isArray(n.data))i=n.data;else if(n.ohlcv&&Array.isArray(n.ohlcv))i=n.ohlcv;else{const d=Object.keys(n);for(const D of d)if(Array.isArray(n[D])){i=n[D];break}}Z(i),console.log("Processed OHLCV data:",i)}catch(r){console.error("Failed to fetch OHLCV data:",r),O("Failed to fetch OHLCV data")}finally{z(!1)}},[]);m.useEffect(()=>{P()},[P]),m.useEffect(()=>{b&&V(b)},[b,V]),m.useEffect(()=>{if(!C)return;const t=setInterval(()=>{b&&V(b)},v);return()=>clearInterval(t)},[C,v,b,V]),m.useEffect(()=>{const t=H();t.length>0?k(t[0]):k("")},[y,j,H]);const x=m.useMemo(()=>{if(console.log("Processing chart data, ohlcvData length:",u.length),!u.length)return console.log("No OHLCV data available"),null;console.log("Sample OHLCV data:",u[0]);const t=[...u].sort((e,s)=>{const o=new Date(e.trade_date.replace(/,/g,"-")),p=new Date(s.trade_date.replace(/,/g,"-"));return o.getTime()-p.getTime()});console.log("Sorted data length:",t.length);const r=t.map(e=>{let s;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[o,p,f]=e.trade_date.split(",");s=new Date(Number(o),Number(p)-1,Number(f)).getTime()}else s=new Date(e.trade_date).getTime();else s=new Date(e.trade_date).getTime();return[s,e.open,e.high,e.low,e.close]});console.log("Candlestick data length:",r.length);const n=t.map(e=>e.close),i=W(n,10),d=W(n,20),D=ae(n,10,20,5),S=t.map((e,s)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,f,w]=e.trade_date.split(",");o=new Date(Number(p),Number(f)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,i[s]||null]}).filter(e=>e[1]!==null),I=t.map((e,s)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,f,w]=e.trade_date.split(",");o=new Date(Number(p),Number(f)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,d[s]||null]}).filter(e=>e[1]!==null),g=t.map((e,s)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,f,w]=e.trade_date.split(",");o=new Date(Number(p),Number(f)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,D.macdLine[s]||null]}).filter(e=>e[1]!==null),l=t.map((e,s)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,f,w]=e.trade_date.split(",");o=new Date(Number(p),Number(f)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,D.signalLine[s]||null]}).filter(e=>e[1]!==null),F=t.map((e,s)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,f,w]=e.trade_date.split(",");o=new Date(Number(p),Number(f)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,D.histogram[s]||null]}).filter(e=>e[1]!==null),c=t.map(e=>{let s;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[o,p,f]=e.trade_date.split(",");s=new Date(Number(o),Number(p)-1,Number(f)).getTime()}else s=new Date(e.trade_date).getTime();else s=new Date(e.trade_date).getTime();return e.wedge_status==="pop"?{x:s,y:e.high,marker:{symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"POP",style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"},y:-20}}:e.wedge_status==="drop"?{x:s,y:e.low,marker:{symbol:"circle",fillColor:"#F92672",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#F92672",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"DROP",style:{color:"#F92672",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #F92672"},y:20}}:null}).filter(Boolean);return console.log("Wedge markers count:",c.length),{candlestickData:r,wedgeMarkers:c,sortedData:t,ema10Data:S,ema20Data:I,macdLineData:g,signalLineData:l,histogramData:F,ema10:i,ema20:d,macdData:D}},[u]),B=m.useMemo(()=>{if(!x)return null;const{candlestickData:t,wedgeMarkers:r,sortedData:n,ema10Data:i,ema20Data:d,macdLineData:D,signalLineData:S,histogramData:I}=x;return{chart:{type:"candlestick",height:650,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",panning:{enabled:!0,type:"x"},style:{fontFamily:"inherit"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1,spacing:[5,5,5,5],reflow:!0,events:{load:function(){},mouseOver:function(g){if(g.target&&g.target.series&&g.target.series.type==="candlestick"){const l=this,F=l.series.find(c=>c.name==="Wedge Status");if(F){const c=g.target.x;F.points.forEach(e=>{if(Math.abs(e.x-c)<24*60*60*1e3){const o=e.dataLabels?.text==="POP"?"#A6E22E":"#F92672";e.update({marker:{radius:12,lineWidth:0,fillColor:o,lineColor:"transparent",symbol:"circle"}},!1)}}),l.redraw()}}},mouseOut:function(g){if(g.target&&g.target.series&&g.target.series.type==="candlestick"){const l=this,F=l.series.find(c=>c.name==="Wedge Status");F&&(F.points.forEach(c=>{const s=c.dataLabels?.text==="POP"?"#A6E22E":"#F92672";c.update({marker:{radius:6,lineWidth:0,fillColor:s,lineColor:"transparent",symbol:"circle"}},!1)}),l.redraw())}},setExtremes:function(g){Y({min:g.min,max:g.max})}}},title:{text:""},subtitle:{text:""},xAxis:{type:"datetime",labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},events:{setExtremes:function(g){Y({min:g.min,max:g.max})}}},yAxis:[{type:"logarithmic",title:{text:"Price ($)",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},minorGridLineWidth:1,minorGridLineColor:"rgba(107, 114, 128, 0.2)",minorTickLength:3,minorTickColor:"rgba(156, 163, 175, 0.4)",minorTickWidth:1},{title:{text:"",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{enabled:!1},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,opposite:!0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},{title:{text:"MACD",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,top:"75%",height:"25%",offset:0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},plotLines:[{value:0,color:"#F8F8F2",width:3,dashStyle:"solid",zIndex:1,label:{text:"0",style:{color:"#F8F8F2",fontSize:"14px",fontWeight:"bold",textShadow:"0 0 3px rgba(0,0,0,0.8)"}}}]}],series:[{name:b,data:t,type:"candlestick",color:"#F92672",upColor:"#A6E22E",downColor:"#F92672",lineColor:"#F92672",upLineColor:"#A6E22E",downLineColor:"#F92672",zIndex:2,lineWidth:2,marker:{enabled:!1,states:{hover:{enabled:!0,radius:6,lineWidth:2,lineColor:"#F92672"}}},tooltip:{enabled:!0,pointFormat:""}},{name:"Volume",data:n.map(g=>{let l;if(typeof g.trade_date=="string")if(g.trade_date.includes(",")){const[F,c,e]=g.trade_date.split(",");l=new Date(Number(F),Number(c)-1,Number(e)).getTime()}else l=new Date(g.trade_date).getTime();else l=new Date(g.trade_date).getTime();return[l,g.volume]}),type:"column",yAxis:1,visible:!0,color:"#66D9EF",opacity:.6,zIndex:1},{name:"Wedge Status",data:r,type:"scatter",zIndex:10,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}",backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){const g=A.dateFormat("%Y-%m-%d",this.x),l=this.point.dataLabels?.text||"Wedge";return`<div style="padding: 4px 0;"><b style="color: ${l==="POP"?"#A6E22E":"#F92672"}; font-size: 14px;">${l} - ${g}</b></div>`}},dataLabels:{enabled:!0,style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"}}},{name:"EMA10",data:i,type:"line",color:"#FD971F",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"EMA20",data:d,type:"line",color:"#66D9EF",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:D,type:"line",color:"#A6E22E",lineWidth:2,yAxis:2,zIndex:1,visible:!1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:S,type:"line",color:"#F92672",lineWidth:2,yAxis:2,zIndex:1,visible:!1,linkedTo:":previous",marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:I,type:"column",color:"#75715E",opacity:.6,yAxis:2,zIndex:0,visible:!1,linkedTo:":previous",tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}}],tooltip:{shared:!1,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let l=`<div style="padding: 4px 0;"><b style="color: #F92672; font-size: 14px;">${A.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;const F=this.x;let c=null;if(c=n.find(e=>{let s;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[o,p,f]=e.trade_date.split(",");s=new Date(Number(o),Number(p)-1,Number(f)).getTime()}else s=new Date(e.trade_date).getTime();else s=new Date(e.trade_date).getTime();return s===F}),!c){const e=A.dateFormat("%Y-%m-%d",F);c=n.find(s=>{let o;if(typeof s.trade_date=="string")if(s.trade_date.includes(",")){const[p,f,w]=s.trade_date.split(","),G=new Date(Number(p),Number(f)-1,Number(w));o=A.dateFormat("%Y-%m-%d",G.getTime())}else{const p=new Date(s.trade_date);o=A.dateFormat("%Y-%m-%d",p.getTime())}else{const p=new Date(s.trade_date);o=A.dateFormat("%Y-%m-%d",p.getTime())}return o===e})}if(c){if(l+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${c.open?.toFixed(2)}</span><br/>`,l+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${c.high?.toFixed(2)}</span><br/>`,l+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${c.low?.toFixed(2)}</span><br/>`,l+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${c.close?.toFixed(2)}</span><br/>`,l+=`<span style="color: #75715E; font-size: 16px;">●</span> <span style="color: #75715E; font-weight: 500;">Volume:</span> <span style="color: #F8F8F2; font-weight: bold;">${c.volume?.toLocaleString()}</span><br/>`,c.wedge_status&&c.wedge_status!=="none"){const s=c.wedge_status==="pop"?"#A6E22E":"#F92672",o=c.wedge_status==="pop"?"POP":"DROP";l+=`<span style="color: ${s}; font-size: 16px;">●</span> <span style="color: ${s}; font-weight: 500;">Wedge Status:</span> <span style="color: ${s}; font-weight: bold;">${o}</span><br/>`}const e=n.findIndex(s=>{let o;if(typeof s.trade_date=="string")if(s.trade_date.includes(",")){const[p,f,w]=s.trade_date.split(",");o=new Date(Number(p),Number(f)-1,Number(w)).getTime()}else o=new Date(s.trade_date).getTime();else o=new Date(s.trade_date).getTime();return o===F});e>=0&&e<x.ema10.length&&x.ema10[e]&&(l+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">EMA10:</span> <span style="color: #F8F8F2; font-weight: bold;">$${x.ema10[e].toFixed(2)}</span><br/>`),e>=0&&e<x.ema20.length&&x.ema20[e]&&(l+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">EMA20:</span> <span style="color: #F8F8F2; font-weight: bold;">$${x.ema20[e].toFixed(2)}</span><br/>`)}else if(this.points&&this.points.length>0){const e=this.points[0];e.series.type==="candlestick"&&e.open!==void 0&&(l+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.open?.toFixed(2)}</span><br/>`,l+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.high?.toFixed(2)}</span><br/>`,l+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.low?.toFixed(2)}</span><br/>`,l+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.close?.toFixed(2)}</span><br/>`)}return this.points?.forEach(e=>{const s=e.series.name;let o=e.y?.toFixed(2);const p=s===b,f=s==="Wedge Status";if(p||s==="Volume"||s==="EMA10"||s==="EMA20"||s==="MACD")return;let X="#75715E",U="#F8F8F2",K="●";f&&(X="#A6E22E",U="#A6E22E"),l+=`<span style="color:${e.color}; font-size: 16px;">${K}</span> <span style="color: ${X}; font-weight: 500;">${s}</span>: <span style="color: ${U}; font-weight: bold;">${o}</span><br/>`}),l}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"14px",color:"#F8F8F2",fontWeight:"600"},itemHoverStyle:{color:"#F92672"},symbolHeight:12,symbolWidth:24,symbolRadius:3,backgroundColor:"#272822",borderWidth:1,borderColor:"#75715E",borderRadius:8,shadow:!0,itemDistance:20,padding:12,width:"100%",height:50,itemWidth:150,useHTML:!1,floating:!1,x:0,y:0},plotOptions:{candlestick:{color:"#F92672",upColor:"#A6E22E",lineColor:"#F92672",upLineColor:"#A6E22E",tooltip:{enabled:!0}},column:{color:"#66D9EF",opacity:.6},series:{animation:{duration:1e3},tooltip:{enabled:!0}}},navigator:{enabled:!0,height:40,margin:10,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)",lineColor:"rgba(96, 165, 250, 0.5)",rifleColor:"rgba(96, 165, 250, 0.8)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.4)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"10px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:8,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"12px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:3,text:"3y"},{type:"year",count:5,text:"5y"},{type:"all",text:"All"}]},responsive:{rules:[{condition:{maxWidth:768},chartOptions:{legend:{enabled:!1},chart:{height:400}}}]},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:14,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)",states:{hover:{fill:"rgba(55, 65, 81, 0.95)",style:{color:"#ffffff"}}}}}}}}},[x,b]),q=t=>{k(t.target.value)},$=m.useCallback(()=>x?.sortedData?M?x.sortedData.filter(t=>{let r;if(typeof t.trade_date=="string")if(t.trade_date.includes(",")){const[n,i,d]=t.trade_date.split(",");r=new Date(Number(n),Number(i)-1,Number(d)).getTime()}else r=new Date(t.trade_date).getTime();else r=new Date(t.trade_date).getTime();return r>=M.min&&r<=M.max}):x.sortedData:x?.sortedData||[],[x,M]),J=m.useCallback(()=>{if(!x?.sortedData)return null;const t=$();if(t.length===0)return null;for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.wedge_status&&n.wedge_status!=="none")return{date:n.trade_date,status:n.wedge_status}}return null},[x,$]);return m.useEffect(()=>{console.log("Debug - categorizedTickers count:",h.length),console.log("Debug - selectedTicker:",b),console.log("Debug - chartData:",x),console.log("Debug - chartOptions:",B)},[h.length,b,x,B]),N&&!u.length?a.jsx("div",{className:`chart-container ${E}`,children:a.jsx(te,{text:"Loading OHLCV data..."})}):R?a.jsxs("div",{className:`chart-container ${E}`,children:[a.jsx(Q,{message:`Error: ${R}`}),a.jsx("div",{className:"mt-4 text-center",children:a.jsx("button",{onClick:()=>P(),className:"btn-primary",disabled:N,children:N?"Refreshing...":"Retry"})})]}):a.jsxs("div",{className:`chart-container ${E}`,children:[a.jsxs("div",{className:"chart-header",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"chart-title",children:b?`${b} OHLCV Chart`:"OHLCV Chart"}),a.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:a.jsx("button",{onClick:()=>P(),disabled:N,className:"btn-secondary text-xs",title:"Refresh data",children:N?a.jsx("div",{className:"loading-spinner w-4 h-4"}):"↻"})})]}),a.jsx("div",{className:"chart-controls mt-2",children:a.jsxs("div",{className:"flex items-center gap-6 flex-wrap",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["Date:",a.jsx("select",{value:y,onChange:t=>L(t.target.value),className:"input-field",disabled:N,children:h.length===0?a.jsx("option",{value:"",children:"No dates available"}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"",children:"Select a date"}),h.map(t=>a.jsxs("option",{value:t.date,children:[t.date.substring(0,4),"-",t.date.substring(4,6),"-",t.date.substring(6,8)]},t.date))]})})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["Wedge Status:",a.jsxs("select",{value:j,onChange:t=>T(t.target.value),className:"input-field",disabled:N||!y,children:[a.jsxs("option",{value:"pop",children:["POP (",(()=>{const t=h.find(r=>r.date===y);return t?`${t.pop.length} tickers (${(t.pop_pct*100).toFixed(1)}%)`:"0 tickers"})(),")"]}),a.jsxs("option",{value:"drop",children:["DROP (",(()=>{const t=h.find(r=>r.date===y);return t?`${t.drop.length} tickers (${(t.drop_pct*100).toFixed(1)}%)`:"0 tickers"})(),")"]})]})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["Ticker:",a.jsx("select",{value:b,onChange:q,className:"input-field",disabled:N||!y,children:H().length===0?a.jsx("option",{value:"",children:"No tickers available"}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"",children:"Select a ticker"}),H().map(t=>a.jsx("option",{value:t,children:t},t))]})})]})]})})]}),x&&a.jsx("div",{className:"chart-stats py-1 px-3",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Current Price"}),a.jsxs("div",{className:"chart-stat-value",children:["$",(()=>{const t=$();return t[t.length-1]?.close?.toFixed(2)||"N/A"})()]})]},"current-price"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Change"}),a.jsx("div",{className:`chart-stat-value ${(()=>{const t=$(),r=t[t.length-1]?.close,n=t[t.length-2]?.close;return r&&n?r>n?"text-green-600":"text-red-600":"text-gray-600"})()}`,children:(()=>{const t=$(),r=t[t.length-1]?.close,n=t[t.length-2]?.close;if(r&&n){const i=r-n,d=i/n*100;return`${i>=0?"+":""}${i.toFixed(2)} (${d>=0?"+":""}${d.toFixed(2)}%)`}return"N/A"})()})]},"change"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Range"}),a.jsx("div",{className:"chart-stat-value",children:(()=>{const r=$().map(d=>d.close);if(r.length===0)return"N/A";const n=Math.max(...r);return`${Math.min(...r).toFixed(2)} - ${n.toFixed(2)}`})()})]},"range"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Last Wedge"}),a.jsx("div",{className:"chart-stat-value",children:(()=>{const t=J();if(!t)return"None";let r;if(typeof t.date=="string")if(t.date.includes(",")){const[d,D,S]=t.date.split(",");r=`${d}-${D.padStart(2,"0")}-${S.padStart(2,"0")}`}else r=t.date;else r=new Date(t.date).toISOString().split("T")[0];const n=t.status==="pop"?"text-green-600":"text-red-600",i=t.status.toUpperCase();return a.jsxs("span",{children:[a.jsx("span",{className:"text-gray-400 text-xs",children:r}),a.jsx("br",{}),a.jsx("span",{className:n,children:i})]})})()})]},"last-wedge"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Date Stats"}),a.jsx("div",{className:"chart-stat-value",children:(()=>{if(!y)return"N/A";const t=h.find(n=>n.date===y);if(!t)return"N/A";const r=`${y.substring(0,4)}-${y.substring(4,6)}-${y.substring(6,8)}`;return a.jsxs("span",{children:[a.jsx("span",{className:"text-gray-400 text-xs",children:r}),a.jsx("br",{}),a.jsxs("span",{className:"text-blue-600",children:[t.pop.length,"P/",t.drop.length,"D"]})]})})()})]},"date-stats")]})}),a.jsx("div",{className:"mt-1",children:B&&a.jsx(ee,{highcharts:A,options:B,constructorType:"stockChart"})})]})};export{ce as default};
