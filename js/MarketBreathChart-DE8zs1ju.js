import{R as K,r as i,j as e}from"./query-vendor-Du5i0pT7.js";import{H as T,E as G,a as U}from"./ErrorMessage-Cc20MXJj.js";import{L as V}from"./index-BBDFoHgB.js";import"./react-vendor-DJG_os-6.js";import"./charts-vendor-CIWdG-YD.js";const _=[{key:"score_sma20",label:"SMA 20",sector:"sector_score20"},{key:"score_sma50",label:"SMA 50",sector:"sector_score50"},{key:"score_sma200",label:"SMA 200",sector:"sector_score200"}],v=["#F92672","#A6E22E","#FD971F","#AE81FF","#66D9EF","#E6DB74","#F92672","#A6E22E","#FD971F","#AE81FF","#66D9EF","#E6DB74","#F92672","#A6E22E","#FD971F","#AE81FF","#66D9EF","#E6DB74","#F92672","#A6E22E"];function w(S){const[h,k,N]=S.split(",");return new Date(Number(h),Number(k)-1,Number(N)).getTime()}const X=K.memo(({indexId:S})=>{const[h,k]=i.useState([]),[N,D]=i.useState(!0),[E,B]=i.useState(null),[p,I]=i.useState(0),[A,O]=i.useState(3),[C,R]=i.useState(!1),[W,L]=i.useState(!1),M=i.useCallback(async t=>{const r=await fetch(`/api/mbs/${t}.json`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const c=await r.json();if(Array.isArray(c)&&c.length>0)return c;throw new Error("No market breadth data available")},[]),F=i.useCallback(async(t=!0)=>{try{t&&D(!0),L(!0),B(null);const r=await M(S);k(r)}catch(r){B(r instanceof Error?r.message:"Failed to load market breadth data"),k([])}finally{D(!1),L(!1)}},[M,S]);i.useEffect(()=>{F()},[F]);const H=i.useCallback(()=>{F(!1)},[F]),P=i.useCallback(t=>{O(Math.max(1,Math.min(20,t)))},[]),s=i.useMemo(()=>{if(!h||h.length===0)return null;const t=_[p],r=[...h].sort((a,l)=>w(a.trade_date)-w(l.trade_date)),c=r.map(a=>w(a.trade_date)),o=r.map(a=>a[t.key]);let d=[];for(const a of r){const l=a[t.sector];if(l&&l.length>0){d=l.map(b=>b.sector_key);break}}let m=0,f=o[0],g=o[0];for(let a=0;a<o.length;a++){const l=o[a];m+=l,l<f&&(f=l),l>g&&(g=l)}const u=m/o.length,y=o.slice(-20),n=y.reduce((a,l)=>a+l,0)/y.length;return{xData:c,scores:o,sectorKeys:d,smaOption:t,sortedData:r,currentScore:o[o.length-1],avgScore:u,minScore:f,maxScore:g,avg20Period:n}},[h,p]),x=i.useMemo(()=>s?{current:s.currentScore,average:s.avgScore,min:s.minScore,max:s.maxScore,avg20Period:s.avg20Period,period:s.smaOption.label}:null,[s?.currentScore,s?.avgScore,s?.minScore,s?.maxScore,s?.avg20Period,s?.smaOption?.label]),j=i.useMemo(()=>{if(!s)return{genericSeries:null,highlightSeries:null,sectorSeries:[],horizontalLines:[]};const{xData:t,scores:r,sectorKeys:c,smaOption:o,sortedData:d}=s,m={name:o.label,data:t.map((n,a)=>[n,r[a]]),color:"#F92672",type:"line",zIndex:2,lineWidth:2,marker:{enabled:!1,states:{hover:{enabled:!0,radius:6,lineWidth:2,lineColor:v[0]}}},id:"main-series"},f={name:`${o.label} (Above 950)`,data:t.map((n,a)=>[n,r[a]>950?r[a]:null]),color:"#FFD700",type:"line",zIndex:3,lineWidth:0,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#FF6B6B",lineColor:"#FFD700",lineWidth:2,states:{hover:{enabled:!0,radius:8,lineWidth:3,lineColor:"#FFD700"}}},enableMouseTracking:!0,stickyTracking:!1,showInLegend:!1},g={name:`${o.label} (Below 200)`,data:t.map((n,a)=>[n,r[a]<200?r[a]:null]),color:"#4ECDC4",type:"line",zIndex:3,lineWidth:0,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#4ECDC4",lineColor:"#FFD700",lineWidth:2,states:{hover:{enabled:!0,radius:8,lineWidth:3,lineColor:"#FFD700"}}},enableMouseTracking:!0,stickyTracking:!1,showInLegend:!1},u=c.map((n,a)=>({name:n,data:t.map((l,b)=>{const $=d[b][o.sector]?.find(Y=>Y.sector_key===n);return[l,$?$.score:null]}),color:v[(a+1)%v.length],type:"area",zIndex:1,lineWidth:1,visible:C,marker:{enabled:!1},stacking:"normal"})),y=[{name:"950 Level",data:t.map(n=>[n,950]),color:"#FF6B6B",type:"line",zIndex:0,lineWidth:2,dashStyle:"Dash",marker:{enabled:!1},showInLegend:!1,enableMouseTracking:!1,stickyTracking:!1},{name:"200 Level",data:t.map(n=>[n,200]),color:"#4ECDC4",type:"line",zIndex:0,lineWidth:2,dashStyle:"Dash",marker:{enabled:!1},showInLegend:!1,enableMouseTracking:!1,stickyTracking:!1}];return{genericSeries:m,highlightAbove950Series:f,highlightBelow200Series:g,sectorSeries:u,horizontalLines:y}},[s,C,p]),z=i.useMemo(()=>{if(!s||!j)return null;const{genericSeries:t,highlightAbove950Series:r,highlightBelow200Series:c,sectorSeries:o,horizontalLines:d}=j;return{chart:{type:"line",height:650,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",spacing:[5,5,5,5],style:{fontFamily:"inherit"},panning:{enabled:!0,type:"x"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1},title:{text:""},xAxis:{type:"datetime",title:{text:"",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},tickLength:6,tickWidth:2,minTickInterval:24*3600*1e3*7,gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},yAxis:{title:{text:"Score",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},min:0,max:1100,gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(75, 85, 99, 0.3)",crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"14px",color:"#F3F4F6",fontWeight:"600"},itemHoverStyle:{color:"#60A5FA"},symbolHeight:12,symbolWidth:24,symbolRadius:3,margin:8,padding:12,backgroundColor:"rgba(0, 0, 0, 0.9)",borderWidth:1,borderColor:"rgba(75, 85, 99, 0.6)",borderRadius:8,shadow:!0,itemDistance:20,width:"100%",x:0,useHTML:!1,floating:!1},tooltip:{shared:!0,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let f=`<div style="padding: 4px 0;"><b style="color: #60A5FA; font-size: 14px;">${T.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;return this.points?.forEach(g=>{const u=g.series.name,y=g.y,n=u===s.smaOption.label;if(u==="950 Level"||u==="200 Level")return;let l="#9ca3af",b="#ffffff";n?(l="#60A5FA",b="#60A5FA"):u.includes("Above 950")?(l="#FF6B6B",b="#FF6B6B"):u.includes("Below 200")&&(l="#4ECDC4",b="#4ECDC4"),f+=`<span style="color:${g.color}; font-size: 16px;">●</span> <span style="color: ${l}; font-weight: 500;">${u}</span>: <span style="color: ${b}; font-weight: bold;">${y}</span><br/>`}),f}},plotOptions:{line:{marker:{enabled:!1},lineWidth:2},area:{marker:{enabled:!1},lineWidth:1,fillOpacity:.6},series:{animation:{duration:600}}},series:[t,r,c,...o,...d],credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:14,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)"}}}},navigator:{enabled:!0,height:40,margin:10,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.4)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"10px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:8,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"12px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:2,text:"2y"},{type:"year",count:3,text:"3y"},{type:"all",text:"All"}],events:{click:function(m){}}}}},[s,j,C,A,p]);return N?e.jsx("div",{className:"chart-container",children:e.jsx(V,{text:"Loading Market Breadth..."})}):E?e.jsx("div",{className:"chart-container",children:e.jsx(G,{message:`Error: ${E}`})}):!h||h.length===0?null:e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"chart-title",children:[h[0].index_name.toUpperCase()," Market Breadth"]}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsx("button",{onClick:H,disabled:W,className:"btn-secondary text-xs",title:"Refresh data",children:W?e.jsx("div",{className:"loading-spinner w-4 h-4"}):"↻"})})]}),e.jsx("div",{className:"chart-controls mt-2",children:e.jsxs("div",{className:"flex items-center gap-6 flex-wrap",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["N-year:",e.jsx("input",{type:"number",min:1,max:20,value:A,onChange:t=>P(Number(t.target.value)),className:"input-field w-16 text-center","aria-label":"N-year window"})]}),_.map((t,r)=>e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer transition-colors duration-200 ${r===p?"text-blue-400 font-semibold":"text-gray-400 hover:text-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"sma",value:String(r),checked:p===r,onChange:c=>I(Number(c.target.value)),"aria-label":`Select ${t.label}`}),e.jsx("span",{className:"text-sm font-medium",children:t.label})]},t.key)),e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:t=>R(t.target.checked)}),"Sector Lines"]})]})})]}),x&&e.jsx("div",{className:"chart-stats py-1 px-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"chart-stat flex flex-col justify-center",children:[e.jsx("div",{className:"chart-stat-label text-center",children:"Score"}),e.jsxs("div",{className:"flex flex-col items-center py-2",children:[e.jsxs("div",{className:"w-full bg-gray-600 rounded-full h-4 mb-2 relative",children:[e.jsxs("div",{className:"absolute inset-0 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute left-0 h-full bg-red-900/50 border-r border-red-600/70",style:{width:`${200/1100*100}%`}}),e.jsx("div",{className:"absolute right-0 h-full bg-red-900/40 border-l border-red-600/60",style:{width:`${150/1100*100}%`,left:`${950/1100*100}%`}})]}),e.jsx("div",{className:"h-full rounded-full transition-all duration-500 relative",style:{width:`${Math.min(100,Math.max(0,x.current/1100*100))}%`,background:x.current>950?"linear-gradient(90deg, #FF6B6B, #FFD700)":x.current<200?"linear-gradient(90deg, #4ECDC4, #FFD700)":"linear-gradient(90deg, #3B82F6, #8B5CF6, #EC4899)"},children:e.jsx("div",{className:"absolute right-0 top-1/2 transform translate-x-1/2 -translate-y-1/2 w-2 h-2 rounded-full border-2 border-white",style:{background:x.current>950?"#FF6B6B":x.current<200?"#4ECDC4":"#3B82F6"}})}),e.jsx("div",{className:"absolute -top-6 left-0 text-xs text-gray-300",children:"0"}),e.jsx("div",{className:"absolute -top-6 left-0 text-xs text-red-400",style:{left:`${200/1100*100}%`},children:"200"}),e.jsx("div",{className:"absolute -top-6 right-0 text-xs text-red-400",style:{right:`${150/1100*100}%`},children:"950"}),e.jsx("div",{className:"absolute -top-6 right-0 text-xs text-gray-300",children:"1100"})]}),e.jsxs("div",{className:"text-sm font-bold text-white",children:[x.current.toFixed(0)," / 1100"]})]})]}),e.jsx("div",{className:"chart-stat md:col-span-2 flex flex-col justify-center",children:e.jsx("div",{className:"grid grid-cols-3 gap-4 py-2",children:(()=>{if(!s)return e.jsx("div",{className:"text-gray-400 text-xs col-span-3 text-center",children:"No sector data"});const{smaOption:t}=s,c=h[h.length-1][t.sector];return!c||c.length===0?e.jsx("div",{className:"text-gray-400 text-xs col-span-3 text-center",children:"No sector data"}):c.sort((d,m)=>m.score-d.score).slice(0,3).map((d,m)=>e.jsxs("div",{className:"text-center flex flex-col items-center bg-gray-800/30 rounded-lg p-3 border border-gray-700/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:v[(m+1)%v.length]}}),e.jsx("span",{className:"font-semibold text-gray-200 text-sm whitespace-nowrap",children:d.sector_key})]}),e.jsx("div",{className:"font-bold text-white text-xl",children:d.score.toFixed(0)})]},d.sector_key))})()})})]})}),e.jsx("div",{className:"mt-1",children:z&&e.jsx(U,{highcharts:T,options:z,callback:t=>{}})})]})});X.displayName="MarketBreathChart";export{X as default};
