import{R as Y,r as i,j as e}from"./query-vendor-Du5i0pT7.js";import{d as K,H as $,L as G,a as U}from"./index-kt27ZEuh.js";import{E as V}from"./ErrorMessage-B58T-2Vz.js";import"./react-vendor-DJG_os-6.js";import"./charts-vendor-CIWdG-YD.js";import"./utils-vendor-BnbtjNgs.js";const T=[{key:"score_sma20",label:"SMA 20",sector:"sector_score20"},{key:"score_sma50",label:"SMA 50",sector:"sector_score50"},{key:"score_sma200",label:"SMA 200",sector:"sector_score200"}],S=["#F92672","#A6E22E","#FD971F","#AE81FF","#66D9EF","#E6DB74","#F92672","#A6E22E","#FD971F","#AE81FF","#66D9EF","#E6DB74","#F92672","#A6E22E","#FD971F","#AE81FF","#66D9EF","#E6DB74","#F92672","#A6E22E"];function D(v){const[d,k,N]=v.split(",");return new Date(Number(d),Number(k)-1,Number(N)).getTime()}const X=Y.memo(({indexId:v})=>{const[d,k]=i.useState([]),[N,E]=i.useState(!0),[B,w]=i.useState(null),[p,_]=i.useState(0),[A,I]=i.useState(3),[C,O]=i.useState(!1),[W,L]=i.useState(!1),F=i.useCallback(async(t=!0)=>{try{t&&E(!0),L(!0),w(null);const a=await K.getMarketBreadth(v);k(a)}catch(a){w(a instanceof Error?a.message:"Failed to load market breadth data"),k([])}finally{E(!1),L(!1)}},[v]);i.useEffect(()=>{F()},[F]);const R=i.useCallback(()=>{F(!1)},[F]),H=i.useCallback(t=>{I(Math.max(1,Math.min(20,t)))},[]),s=i.useMemo(()=>{if(!d||d.length===0)return null;const t=T[p],a=[...d].sort((r,l)=>D(r.trade_date)-D(l.trade_date)),h=a.map(r=>D(r.trade_date)),o=a.map(r=>r[t.key]);let c=[];for(const r of a){const l=r[t.sector];if(l&&l.length>0){c=l.map(f=>f.sector_key);break}}let m=0,b=o[0],u=o[0];for(let r=0;r<o.length;r++){const l=o[r];m+=l,l<b&&(b=l),l>u&&(u=l)}const g=m/o.length,y=o.slice(-20),n=y.reduce((r,l)=>r+l,0)/y.length;return{xData:h,scores:o,sectorKeys:c,smaOption:t,sortedData:a,currentScore:o[o.length-1],avgScore:g,minScore:b,maxScore:u,avg20Period:n}},[d,p]),x=i.useMemo(()=>s?{current:s.currentScore,average:s.avgScore,min:s.minScore,max:s.maxScore,avg20Period:s.avg20Period,period:s.smaOption.label}:null,[s?.currentScore,s?.avgScore,s?.minScore,s?.maxScore,s?.avg20Period,s?.smaOption?.label]),j=i.useMemo(()=>{if(!s)return{genericSeries:null,highlightSeries:null,sectorSeries:[],horizontalLines:[]};const{xData:t,scores:a,sectorKeys:h,smaOption:o,sortedData:c}=s,m={name:o.label,data:t.map((n,r)=>[n,a[r]]),color:"#F92672",type:"line",zIndex:2,lineWidth:2,marker:{enabled:!1,states:{hover:{enabled:!0,radius:6,lineWidth:2,lineColor:S[0]}}},id:"main-series"},b={name:`${o.label} (Above 950)`,data:t.map((n,r)=>[n,a[r]>950?a[r]:null]),color:"#FFD700",type:"line",zIndex:3,lineWidth:0,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#FF6B6B",lineColor:"#FFD700",lineWidth:2,states:{hover:{enabled:!0,radius:8,lineWidth:3,lineColor:"#FFD700"}}},enableMouseTracking:!0,stickyTracking:!1,showInLegend:!1},u={name:`${o.label} (Below 200)`,data:t.map((n,r)=>[n,a[r]<200?a[r]:null]),color:"#4ECDC4",type:"line",zIndex:3,lineWidth:0,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#4ECDC4",lineColor:"#FFD700",lineWidth:2,states:{hover:{enabled:!0,radius:8,lineWidth:3,lineColor:"#FFD700"}}},enableMouseTracking:!0,stickyTracking:!1,showInLegend:!1},g=h.map((n,r)=>({name:n,data:t.map((l,f)=>{const z=c[f][o.sector]?.find(P=>P.sector_key===n);return[l,z?z.score:null]}),color:S[(r+1)%S.length],type:"area",zIndex:1,lineWidth:1,visible:C,marker:{enabled:!1},stacking:"normal"})),y=[{name:"950 Level",data:t.map(n=>[n,950]),color:"#FF6B6B",type:"line",zIndex:0,lineWidth:2,dashStyle:"Dash",marker:{enabled:!1},showInLegend:!1,enableMouseTracking:!1,stickyTracking:!1},{name:"200 Level",data:t.map(n=>[n,200]),color:"#4ECDC4",type:"line",zIndex:0,lineWidth:2,dashStyle:"Dash",marker:{enabled:!1},showInLegend:!1,enableMouseTracking:!1,stickyTracking:!1}];return{genericSeries:m,highlightAbove950Series:b,highlightBelow200Series:u,sectorSeries:g,horizontalLines:y}},[s,C,p]),M=i.useMemo(()=>{if(!s||!j)return null;const{genericSeries:t,highlightAbove950Series:a,highlightBelow200Series:h,sectorSeries:o,horizontalLines:c}=j;return{chart:{type:"line",height:650,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",spacing:[5,5,5,5],style:{fontFamily:"inherit"},panning:{enabled:!0,type:"x"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1},title:{text:""},xAxis:{type:"datetime",title:{text:"",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},tickLength:6,tickWidth:2,minTickInterval:24*3600*1e3*7,gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},yAxis:{title:{text:"Score",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},min:0,max:1100,gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(75, 85, 99, 0.3)",crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"14px",color:"#F3F4F6",fontWeight:"600"},itemHoverStyle:{color:"#60A5FA"},symbolHeight:12,symbolWidth:24,symbolRadius:3,margin:8,padding:12,backgroundColor:"rgba(0, 0, 0, 0.9)",borderWidth:1,borderColor:"rgba(75, 85, 99, 0.6)",borderRadius:8,shadow:!0,itemDistance:20,width:"100%",x:0,useHTML:!1,floating:!1},tooltip:{shared:!0,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let b=`<div style="padding: 4px 0;"><b style="color: #60A5FA; font-size: 14px;">${$.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;return this.points?.forEach(u=>{const g=u.series.name,y=u.y,n=g===s.smaOption.label;if(g==="950 Level"||g==="200 Level")return;let l="#9ca3af",f="#ffffff";n?(l="#60A5FA",f="#60A5FA"):g.includes("Above 950")?(l="#FF6B6B",f="#FF6B6B"):g.includes("Below 200")&&(l="#4ECDC4",f="#4ECDC4"),b+=`<span style="color:${u.color}; font-size: 16px;">●</span> <span style="color: ${l}; font-weight: 500;">${g}</span>: <span style="color: ${f}; font-weight: bold;">${y}</span><br/>`}),b}},plotOptions:{line:{marker:{enabled:!1},lineWidth:2},area:{marker:{enabled:!1},lineWidth:1,fillOpacity:.6},series:{animation:{duration:600}}},series:[t,a,h,...o,...c],credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:14,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)"}}}},navigator:{enabled:!0,height:40,margin:10,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.4)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"10px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:8,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"12px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:2,text:"2y"},{type:"year",count:3,text:"3y"},{type:"all",text:"All"}],events:{click:function(m){}}}}},[s,j,C,A,p]);return N?e.jsx("div",{className:"chart-container",children:e.jsx(G,{text:"Loading Market Breadth..."})}):B?e.jsx("div",{className:"chart-container",children:e.jsx(V,{message:`Error: ${B}`})}):!d||d.length===0?null:e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header py-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"chart-title text-lg",children:[d[0].index_name.toUpperCase()," Market Breadth"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:["N-year:",e.jsx("input",{type:"number",min:1,max:20,value:A,onChange:t=>H(Number(t.target.value)),className:"input-field w-16 text-center","aria-label":"N-year window"})]}),T.map((t,a)=>e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer transition-colors duration-200 ${a===p?"text-primary-400 font-semibold":"text-text-tertiary hover:text-text-secondary"}`,children:[e.jsx("input",{type:"radio",name:"sma",value:String(a),checked:p===a,onChange:h=>_(Number(h.target.value)),"aria-label":`Select ${t.label}`}),e.jsx("span",{className:"text-sm font-medium",children:t.label})]},t.key)),e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium cursor-pointer text-text-primary",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:t=>O(t.target.checked)}),"Sector Lines"]}),e.jsx("button",{onClick:R,disabled:W,className:"btn-secondary text-xs",title:"Refresh data",children:W?e.jsx("div",{className:"loading-spinner w-4 h-4"}):"↻"})]})]})}),x&&e.jsx("div",{className:"chart-stats py-0.5",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"chart-stat flex flex-col justify-center",children:[e.jsx("div",{className:"chart-stat-label text-center text-xs leading-tight",children:"Score"}),e.jsxs("div",{className:"flex flex-col items-center py-1",children:[e.jsxs("div",{className:"w-full bg-bg-tertiary rounded-full h-3 mb-1 relative",children:[e.jsxs("div",{className:"absolute inset-0 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute left-0 h-full bg-danger-900/50 border-r border-danger-600/70",style:{width:`${200/1100*100}%`}}),e.jsx("div",{className:"absolute right-0 h-full bg-danger-900/40 border-l border-danger-600/60",style:{width:`${150/1100*100}%`,left:`${950/1100*100}%`}})]}),e.jsx("div",{className:"h-full rounded-full transition-all duration-500 relative",style:{width:`${Math.min(100,Math.max(0,x.current/1100*100))}%`,background:x.current>950?"linear-gradient(90deg, #FF6B6B, #FFD700)":x.current<200?"linear-gradient(90deg, #4ECDC4, #FFD700)":"linear-gradient(90deg, #3B82F6, #8B5CF6, #EC4899)"},children:e.jsx("div",{className:"absolute right-0 top-1/2 transform translate-x-1/2 -translate-y-1/2 w-2 h-2 rounded-full border-2 border-white",style:{background:x.current>950?"#FF6B6B":x.current<200?"#4ECDC4":"#3B82F6"}})}),e.jsx("div",{className:"absolute -top-5 left-0 text-xs text-text-tertiary",children:"0"}),e.jsx("div",{className:"absolute -top-5 left-0 text-xs text-danger-400",style:{left:`${200/1100*100}%`},children:"200"}),e.jsx("div",{className:"absolute -top-5 right-0 text-xs text-danger-400",style:{right:`${150/1100*100}%`},children:"950"}),e.jsx("div",{className:"absolute -top-5 right-0 text-xs text-text-tertiary",children:"1100"})]}),e.jsxs("div",{className:"text-sm font-bold text-text-primary leading-tight",children:[x.current.toFixed(0)," / 1100"]})]})]}),e.jsx("div",{className:"chart-stat md:col-span-2 flex flex-col justify-center",children:e.jsx("div",{className:"grid grid-cols-3 gap-2 py-1",children:(()=>{if(!s)return e.jsx("div",{className:"text-text-tertiary text-xs col-span-3 text-center",children:"No sector data"});const{smaOption:t}=s,h=d[d.length-1][t.sector];return!h||h.length===0?e.jsx("div",{className:"text-text-tertiary text-xs col-span-3 text-center",children:"No sector data"}):h.sort((c,m)=>m.score-c.score).slice(0,3).map((c,m)=>e.jsxs("div",{className:"text-center flex flex-col items-center bg-bg-tertiary rounded-lg p-2 border border-border-secondary",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:S[(m+1)%S.length]}}),e.jsx("span",{className:"font-semibold text-text-primary text-xs whitespace-nowrap leading-tight",children:c.sector_key})]}),e.jsx("div",{className:"font-bold text-text-primary text-lg leading-tight",children:c.score.toFixed(0)})]},c.sector_key))})()})})]})}),e.jsx("div",{className:"mt-1",children:M&&e.jsx(U,{highcharts:$,options:M,callback:t=>{}})})]})});X.displayName="MarketBreathChart";export{X as default};
