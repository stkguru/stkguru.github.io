import{r as m,j as a}from"./query-vendor-Du5i0pT7.js";import{H as W,E as te,a as q}from"./ErrorMessage-Cc20MXJj.js";import{L as ae}from"./index-CqKBTXPB.js";import"./react-vendor-DJG_os-6.js";import"./charts-vendor-CIWdG-YD.js";const $=(w,v)=>{const E=[],y=2/(v+1);let N=0;for(let u=0;u<v&&u<w.length;u++)N+=w[u];E[v-1]=N/v;for(let u=v;u<w.length;u++)E[u]=w[u]*y+E[u-1]*(1-y);return E},oe=(w,v=10,E=20,y=5)=>{const N=$(w,v),u=$(w,E),A=[],D=[],L=[];for(let f=Math.max(v,E)-1;f<w.length;f++)A[f]=N[f]-u[f];const T=$(A.filter(f=>f!==void 0),y);let j=0;for(let f=Math.max(v,E)-1;f<w.length;f++)A[f]!==void 0&&(D[f]=T[j],L[f]=A[f]-D[f],j++);return{macdLine:A,signalLine:D,histogram:L}},ge=({autoRefresh:w=!1,refreshInterval:v=60*60*1e3,className:E=""})=>{const[y,N]=m.useState(""),[u,A]=m.useState([]),[D,L]=m.useState(""),[T,j]=m.useState("pop"),[f,J]=m.useState([]),[_,O]=m.useState(!0),[I,M]=m.useState(null),[B,Y]=m.useState(null),P=m.useCallback(async()=>{try{O(!0),M(null),console.log("Fetching categorized tickers from /api/wedge_pop/stats.json");const t=await fetch("/api/wedge_pop/stats.json");if(console.log("Response status:",t.status),!t.ok)throw new Error(`Failed to fetch categorized tickers: ${t.status}`);const r=await t.json();console.log("Categorized tickers data:",r);const d=r.sort((s,h)=>{const k=new Date(s.date.substring(0,4)+"-"+s.date.substring(4,6)+"-"+s.date.substring(6,8));return new Date(h.date.substring(0,4)+"-"+h.date.substring(4,6)+"-"+h.date.substring(6,8)).getTime()-k.getTime()}).map(s=>({date:s.date,pop:s.pop,drop:s.drop,pop_pct:s.pop_pct,drop_pct:s.drop_pct}));if(A(d),console.log("Processed categorized tickers:",d),d.length>0){const s=d[0].date;L(s),d[0].pop.length>0?(N(d[0].pop[0]),j("pop")):d[0].drop.length>0&&(N(d[0].drop[0]),j("drop"))}}catch(t){console.error("Failed to fetch categorized tickers:",t),M("Failed to fetch categorized ticker list")}finally{O(!1)}},[]),H=m.useCallback(()=>{if(!D||!u.length)return[];const t=u.find(r=>r.date===D);return t?T==="pop"?t.pop:t.drop:[]},[D,T,u]),V=m.useCallback(async t=>{if(t)try{O(!0),M(null),console.log("Fetching OHLCV data for ticker:",t);const r=await fetch(`/api/ohlcvw/${t}.json`);if(console.log("OHLCV response status:",r.status),!r.ok)throw new Error(`Failed to fetch OHLCV data: ${r.status}`);const l=await r.json();console.log("OHLCV data:",l);let d=[];if(Array.isArray(l))d=l;else if(l&&typeof l=="object")if(l.data&&Array.isArray(l.data))d=l.data;else if(l.ohlcv&&Array.isArray(l.ohlcv))d=l.ohlcv;else{const s=Object.keys(l);for(const h of s)if(Array.isArray(l[h])){d=l[h];break}}J(d),console.log("Processed OHLCV data:",d)}catch(r){console.error("Failed to fetch OHLCV data:",r),M("Failed to fetch OHLCV data")}finally{O(!1)}},[]);m.useEffect(()=>{P()},[P]),m.useEffect(()=>{y&&V(y)},[y,V]),m.useEffect(()=>{if(!w)return;const t=setInterval(()=>{y&&V(y)},v);return()=>clearInterval(t)},[w,v,y,V]),m.useEffect(()=>{const t=H();t.length>0?N(t[0]):N("")},[D,T,H]);const x=m.useMemo(()=>{if(console.log("Processing chart data, ohlcvData length:",f.length),!f.length)return console.log("No OHLCV data available"),null;console.log("Sample OHLCV data:",f[0]);const t=[...f].sort((e,o)=>{const n=new Date(e.trade_date.replace(/,/g,"-")),p=new Date(o.trade_date.replace(/,/g,"-"));return n.getTime()-p.getTime()});console.log("Sorted data length:",t.length);const r=t.map(e=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[n,p,b]=e.trade_date.split(",");o=new Date(Number(n),Number(p)-1,Number(b)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,e.open,e.high,e.low,e.close]});console.log("Candlestick data length:",r.length);const l=t.map(e=>e.close),d=$(l,10),s=$(l,20),h=oe(l,10,20,5),k=t.map((e,o)=>{let n;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,b,C]=e.trade_date.split(",");n=new Date(Number(p),Number(b)-1,Number(C)).getTime()}else n=new Date(e.trade_date).getTime();else n=new Date(e.trade_date).getTime();return[n,d[o]||null]}).filter(e=>e[1]!==null),S=t.map((e,o)=>{let n;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,b,C]=e.trade_date.split(",");n=new Date(Number(p),Number(b)-1,Number(C)).getTime()}else n=new Date(e.trade_date).getTime();else n=new Date(e.trade_date).getTime();return[n,s[o]||null]}).filter(e=>e[1]!==null),c=t.map((e,o)=>{let n;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,b,C]=e.trade_date.split(",");n=new Date(Number(p),Number(b)-1,Number(C)).getTime()}else n=new Date(e.trade_date).getTime();else n=new Date(e.trade_date).getTime();return[n,h.macdLine[o]||null]}).filter(e=>e[1]!==null),i=t.map((e,o)=>{let n;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,b,C]=e.trade_date.split(",");n=new Date(Number(p),Number(b)-1,Number(C)).getTime()}else n=new Date(e.trade_date).getTime();else n=new Date(e.trade_date).getTime();return[n,h.signalLine[o]||null]}).filter(e=>e[1]!==null),F=t.map((e,o)=>{let n;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,b,C]=e.trade_date.split(",");n=new Date(Number(p),Number(b)-1,Number(C)).getTime()}else n=new Date(e.trade_date).getTime();else n=new Date(e.trade_date).getTime();return[n,h.histogram[o]||null]}).filter(e=>e[1]!==null),g=t.map(e=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[n,p,b]=e.trade_date.split(",");o=new Date(Number(n),Number(p)-1,Number(b)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return e.wedge_status==="pop"?{x:o,y:e.high,marker:{symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"POP",style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"},y:-20}}:e.wedge_status==="drop"?{x:o,y:e.low,marker:{symbol:"circle",fillColor:"#F92672",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#F92672",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"DROP",style:{color:"#F92672",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #F92672"},y:20}}:null}).filter(Boolean);return console.log("Wedge markers count:",g.length),{candlestickData:r,wedgeMarkers:g,sortedData:t,ema10Data:k,ema20Data:S,macdLineData:c,signalLineData:i,histogramData:F,ema10:d,ema20:s,macdData:h}},[f]),R=m.useMemo(()=>{if(!x)return null;const{candlestickData:t,wedgeMarkers:r,sortedData:l,ema10Data:d,ema20Data:s,macdLineData:h,signalLineData:k,histogramData:S}=x;return{chart:{type:"candlestick",height:650,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",panning:{enabled:!0,type:"x"},style:{fontFamily:"inherit"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1,spacing:[5,5,5,5],reflow:!0,events:{load:function(){},mouseOver:function(c){if(c.target&&c.target.series&&c.target.series.type==="candlestick"){const i=this,F=i.series.find(g=>g.name==="Wedge Status");if(F){const g=c.target.x;F.points.forEach(e=>{if(Math.abs(e.x-g)<24*60*60*1e3){const n=e.dataLabels?.text==="POP"?"#A6E22E":"#F92672";e.update({marker:{radius:12,lineWidth:0,fillColor:n,lineColor:"transparent",symbol:"circle"}},!1)}}),i.redraw()}}},mouseOut:function(c){if(c.target&&c.target.series&&c.target.series.type==="candlestick"){const i=this,F=i.series.find(g=>g.name==="Wedge Status");F&&(F.points.forEach(g=>{const o=g.dataLabels?.text==="POP"?"#A6E22E":"#F92672";g.update({marker:{radius:6,lineWidth:0,fillColor:o,lineColor:"transparent",symbol:"circle"}},!1)}),i.redraw())}},setExtremes:function(c){Y({min:c.min,max:c.max})}}},title:{text:""},subtitle:{text:""},xAxis:{type:"datetime",labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},events:{setExtremes:function(c){Y({min:c.min,max:c.max})}}},yAxis:[{type:"logarithmic",title:{text:"Price ($)",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},minorGridLineWidth:1,minorGridLineColor:"rgba(107, 114, 128, 0.2)",minorTickLength:3,minorTickColor:"rgba(156, 163, 175, 0.4)",minorTickWidth:1},{title:{text:"",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{enabled:!1},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,opposite:!0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},{title:{text:"MACD",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,top:"75%",height:"25%",offset:0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},plotLines:[{value:0,color:"#F8F8F2",width:3,dashStyle:"solid",zIndex:1,label:{text:"0",style:{color:"#F8F8F2",fontSize:"14px",fontWeight:"bold",textShadow:"0 0 3px rgba(0,0,0,0.8)"}}}]}],series:[{name:y,data:t,type:"candlestick",color:"#F92672",upColor:"#A6E22E",downColor:"#F92672",lineColor:"#F92672",upLineColor:"#A6E22E",downLineColor:"#F92672",zIndex:2,lineWidth:2,marker:{enabled:!1,states:{hover:{enabled:!0,radius:6,lineWidth:2,lineColor:"#F92672"}}},tooltip:{enabled:!0,pointFormat:""}},{name:"Volume",data:l.map(c=>{let i;if(typeof c.trade_date=="string")if(c.trade_date.includes(",")){const[F,g,e]=c.trade_date.split(",");i=new Date(Number(F),Number(g)-1,Number(e)).getTime()}else i=new Date(c.trade_date).getTime();else i=new Date(c.trade_date).getTime();return[i,c.volume]}),type:"column",yAxis:1,visible:!0,color:"#66D9EF",opacity:.6,zIndex:1},{name:"Wedge Status",data:r,type:"scatter",zIndex:10,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}",backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){const c=W.dateFormat("%Y-%m-%d",this.x),i=this.point.dataLabels?.text||"Wedge";return`<div style="padding: 4px 0;"><b style="color: ${i==="POP"?"#A6E22E":"#F92672"}; font-size: 14px;">${i} - ${c}</b></div>`}},dataLabels:{enabled:!0,style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"}}},{name:"EMA10",data:d,type:"line",color:"#FD971F",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"EMA20",data:s,type:"line",color:"#66D9EF",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:h,type:"line",color:"#A6E22E",lineWidth:2,yAxis:2,zIndex:1,visible:!1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:k,type:"line",color:"#F92672",lineWidth:2,yAxis:2,zIndex:1,visible:!1,linkedTo:":previous",marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:S,type:"column",color:"#75715E",opacity:.6,yAxis:2,zIndex:0,visible:!1,linkedTo:":previous",tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}}],tooltip:{shared:!1,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let i=`<div style="padding: 4px 0;"><b style="color: #F92672; font-size: 14px;">${W.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;const F=this.x;let g=null;if(g=l.find(e=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[n,p,b]=e.trade_date.split(",");o=new Date(Number(n),Number(p)-1,Number(b)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return o===F}),!g){const e=W.dateFormat("%Y-%m-%d",F);g=l.find(o=>{let n;if(typeof o.trade_date=="string")if(o.trade_date.includes(",")){const[p,b,C]=o.trade_date.split(","),X=new Date(Number(p),Number(b)-1,Number(C));n=W.dateFormat("%Y-%m-%d",X.getTime())}else{const p=new Date(o.trade_date);n=W.dateFormat("%Y-%m-%d",p.getTime())}else{const p=new Date(o.trade_date);n=W.dateFormat("%Y-%m-%d",p.getTime())}return n===e})}if(g){if(i+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.open?.toFixed(2)}</span><br/>`,i+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.high?.toFixed(2)}</span><br/>`,i+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.low?.toFixed(2)}</span><br/>`,i+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.close?.toFixed(2)}</span><br/>`,i+=`<span style="color: #75715E; font-size: 16px;">●</span> <span style="color: #75715E; font-weight: 500;">Volume:</span> <span style="color: #F8F8F2; font-weight: bold;">${g.volume?.toLocaleString()}</span><br/>`,g.wedge_status&&g.wedge_status!=="none"){const o=g.wedge_status==="pop"?"#A6E22E":"#F92672",n=g.wedge_status==="pop"?"POP":"DROP";i+=`<span style="color: ${o}; font-size: 16px;">●</span> <span style="color: ${o}; font-weight: 500;">Wedge Status:</span> <span style="color: ${o}; font-weight: bold;">${n}</span><br/>`}const e=l.findIndex(o=>{let n;if(typeof o.trade_date=="string")if(o.trade_date.includes(",")){const[p,b,C]=o.trade_date.split(",");n=new Date(Number(p),Number(b)-1,Number(C)).getTime()}else n=new Date(o.trade_date).getTime();else n=new Date(o.trade_date).getTime();return n===F});e>=0&&e<x.ema10.length&&x.ema10[e]&&(i+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">EMA10:</span> <span style="color: #F8F8F2; font-weight: bold;">$${x.ema10[e].toFixed(2)}</span><br/>`),e>=0&&e<x.ema20.length&&x.ema20[e]&&(i+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">EMA20:</span> <span style="color: #F8F8F2; font-weight: bold;">$${x.ema20[e].toFixed(2)}</span><br/>`)}else if(this.points&&this.points.length>0){const e=this.points[0];e.series.type==="candlestick"&&e.open!==void 0&&(i+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.open?.toFixed(2)}</span><br/>`,i+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.high?.toFixed(2)}</span><br/>`,i+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.low?.toFixed(2)}</span><br/>`,i+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.close?.toFixed(2)}</span><br/>`)}return this.points?.forEach(e=>{const o=e.series.name;let n=e.y?.toFixed(2);const p=o===y,b=o==="Wedge Status";if(p||o==="Volume"||o==="EMA10"||o==="EMA20"||o==="MACD")return;let U="#75715E",Z="#F8F8F2",ee="●";b&&(U="#A6E22E",Z="#A6E22E"),i+=`<span style="color:${e.color}; font-size: 16px;">${ee}</span> <span style="color: ${U}; font-weight: 500;">${o}</span>: <span style="color: ${Z}; font-weight: bold;">${n}</span><br/>`}),i}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"14px",color:"#F8F8F2",fontWeight:"600"},itemHoverStyle:{color:"#F92672"},symbolHeight:12,symbolWidth:24,symbolRadius:3,backgroundColor:"#272822",borderWidth:1,borderColor:"#75715E",borderRadius:8,shadow:!0,itemDistance:20,padding:12,width:"100%",height:50,itemWidth:150,useHTML:!1,floating:!1,x:0,y:0},plotOptions:{candlestick:{color:"#F92672",upColor:"#A6E22E",lineColor:"#F92672",upLineColor:"#A6E22E",tooltip:{enabled:!0}},column:{color:"#66D9EF",opacity:.6},series:{animation:{duration:1e3},tooltip:{enabled:!0}}},navigator:{enabled:!0,height:40,margin:10,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)",lineColor:"rgba(96, 165, 250, 0.5)",rifleColor:"rgba(96, 165, 250, 0.8)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.4)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"10px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:8,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"12px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:3,text:"3y"},{type:"year",count:5,text:"5y"},{type:"all",text:"All"}]},responsive:{rules:[{condition:{maxWidth:768},chartOptions:{legend:{enabled:!1},chart:{height:400}}}]},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:14,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)",states:{hover:{fill:"rgba(55, 65, 81, 0.95)",style:{color:"#ffffff"}}}}}}}}},[x,y]),G=m.useMemo(()=>{if(!u.length)return null;const t=[...u].sort((s,h)=>{const k=new Date(s.date.substring(0,4)+"-"+s.date.substring(4,6)+"-"+s.date.substring(6,8)),S=new Date(h.date.substring(0,4)+"-"+h.date.substring(4,6)+"-"+h.date.substring(6,8));return k.getTime()-S.getTime()}),r=t.map(s=>[new Date(s.date.substring(0,4)+"-"+s.date.substring(4,6)+"-"+s.date.substring(6,8)).getTime(),s.pop.length]),l=t.map(s=>[new Date(s.date.substring(0,4)+"-"+s.date.substring(4,6)+"-"+s.date.substring(6,8)).getTime(),s.drop.length]),d=t.map(s=>[new Date(s.date.substring(0,4)+"-"+s.date.substring(4,6)+"-"+s.date.substring(6,8)).getTime(),s.pop.length+s.drop.length]);return{chart:{type:"area",height:400,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",panning:{enabled:!0,type:"x"},style:{fontFamily:"inherit"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1,spacing:[5,5,5,5],reflow:!0},title:{text:"Wedge Statistics",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"},align:"left",x:10,y:8},xAxis:{type:"datetime",labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"},rotation:0,step:2},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},yAxis:{title:{text:"Number of Events",style:{fontSize:"14px",fontWeight:"700",color:"#E5E7EB"}},labels:{style:{fontSize:"12px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:1,gridLineColor:"rgba(107, 114, 128, 0.3)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:1,tickLength:4,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:1,dashStyle:"shortdot"}},series:[{name:"DROP Events",data:l,type:"areaspline",color:"#F92672",fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(249, 38, 114, 0.8)"],[1,"rgba(249, 38, 114, 0.1)"]]},lineColor:"#F92672",lineWidth:2,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y} events"}},{name:"POP Events",data:r,type:"areaspline",color:"#A6E22E",fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(166, 226, 46, 0.8)"],[1,"rgba(166, 226, 46, 0.1)"]]},lineColor:"#A6E22E",lineWidth:2,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y} events"}},{name:"Total Events",data:d,type:"spline",color:"#66D9EF",lineWidth:3,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y} events"},zIndex:10}],tooltip:{shared:!0,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let h=`<div style="padding: 4px 0;"><b style="color: #F92672; font-size: 14px;">${W.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;return this.points?.forEach(k=>{const S=k.series.name,c=k.y;let i="#75715E";S.includes("POP")?i="#A6E22E":S.includes("DROP")?i="#F92672":S.includes("Total")&&(i="#66D9EF"),h+=`<span style="color: ${i}; font-size: 16px;">●</span> <span style="color: ${i}; font-weight: 500;">${S}:</span> <span style="color: #F8F8F2; font-weight: bold;">${c}</span><br/>`}),h}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"12px",color:"#F8F8F2",fontWeight:"600"},itemHoverStyle:{color:"#F92672"},symbolHeight:10,symbolWidth:20,symbolRadius:2,backgroundColor:"#272822",borderWidth:1,borderColor:"#75715E",borderRadius:6,shadow:!0,itemDistance:15,padding:8,width:"100%",height:40,itemWidth:120,useHTML:!1,floating:!1,x:0,y:0},plotOptions:{area:{stacking:"normal",lineWidth:2,marker:{enabled:!0,radius:3,symbol:"circle",states:{hover:{enabled:!0,radius:5,brightness:.3}}},tooltip:{enabled:!0}},series:{animation:{duration:1e3},tooltip:{enabled:!0}}},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:6,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"11px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:3,text:"3y"},{type:"year",count:5,text:"5y"},{type:"all",text:"All"}]},navigator:{enabled:!0,height:30,margin:5,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)",lineColor:"rgba(96, 165, 250, 0.5)",rifleColor:"rgba(96, 165, 250, 0.8)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.3)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"9px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},responsive:{rules:[{condition:{maxWidth:768},chartOptions:{legend:{enabled:!1},chart:{height:200},rangeSelector:{enabled:!1},navigator:{enabled:!1},scrollbar:{enabled:!1}}}]},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:12,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)",states:{hover:{fill:"rgba(55, 65, 81, 0.95)",style:{color:"#ffffff"}}}}}}}}},[u]),K=t=>{N(t.target.value)},z=m.useCallback(()=>x?.sortedData?B?x.sortedData.filter(t=>{let r;if(typeof t.trade_date=="string")if(t.trade_date.includes(",")){const[l,d,s]=t.trade_date.split(",");r=new Date(Number(l),Number(d)-1,Number(s)).getTime()}else r=new Date(t.trade_date).getTime();else r=new Date(t.trade_date).getTime();return r>=B.min&&r<=B.max}):x.sortedData:x?.sortedData||[],[x,B]),Q=m.useCallback(()=>{if(!x?.sortedData)return null;const t=z();if(t.length===0)return null;for(let r=t.length-1;r>=0;r--){const l=t[r];if(l.wedge_status&&l.wedge_status!=="none")return{date:l.trade_date,status:l.wedge_status}}return null},[x,z]);return m.useEffect(()=>{console.log("Debug - categorizedTickers count:",u.length),console.log("Debug - selectedTicker:",y),console.log("Debug - chartData:",x),console.log("Debug - chartOptions:",R)},[u.length,y,x,R]),_&&!f.length?a.jsx("div",{className:`chart-container ${E}`,children:a.jsx(ae,{text:"Loading OHLCV data..."})}):I?a.jsxs("div",{className:`chart-container ${E}`,children:[a.jsx(te,{message:`Error: ${I}`}),a.jsx("div",{className:"mt-4 text-center",children:a.jsx("button",{onClick:()=>P(),className:"btn-primary",disabled:_,children:_?"Refreshing...":"Retry"})})]}):a.jsxs("div",{className:`chart-container ${E}`,children:[a.jsxs("div",{className:"chart-header",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"chart-title",children:y?`${y} OHLCV Chart`:"OHLCV Chart"}),a.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:a.jsx("button",{onClick:()=>P(),disabled:_,className:"btn-secondary text-xs",title:"Refresh data",children:_?a.jsx("div",{className:"loading-spinner w-4 h-4"}):"↻"})})]}),a.jsx("div",{className:"chart-controls mt-2",children:a.jsxs("div",{className:"flex items-center gap-6 flex-wrap",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["Date:",a.jsx("select",{value:D,onChange:t=>L(t.target.value),className:"input-field",disabled:_,children:u.length===0?a.jsx("option",{value:"",children:"No dates available"}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"",children:"Select a date"}),u.map(t=>a.jsxs("option",{value:t.date,children:[t.date.substring(0,4),"-",t.date.substring(4,6),"-",t.date.substring(6,8)]},t.date))]})})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["Wedge Status:",a.jsxs("select",{value:T,onChange:t=>j(t.target.value),className:"input-field",disabled:_||!D,children:[a.jsxs("option",{value:"pop",children:["POP (",(()=>{const t=u.find(r=>r.date===D);return t?`${t.pop.length} tickers (${(t.pop_pct*100).toFixed(1)}%)`:"0 tickers"})(),")"]}),a.jsxs("option",{value:"drop",children:["DROP (",(()=>{const t=u.find(r=>r.date===D);return t?`${t.drop.length} tickers (${(t.drop_pct*100).toFixed(1)}%)`:"0 tickers"})(),")"]})]})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["Ticker:",a.jsx("select",{value:y,onChange:K,className:"input-field",disabled:_||!D,children:H().length===0?a.jsx("option",{value:"",children:"No tickers available"}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"",children:"Select a ticker"}),H().map(t=>a.jsx("option",{value:t,children:t},t))]})})]})]})})]}),x&&a.jsx("div",{className:"chart-stats py-1 px-3",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Current Price"}),a.jsxs("div",{className:"chart-stat-value",children:["$",(()=>{const t=z();return t[t.length-1]?.close?.toFixed(2)||"N/A"})()]})]},"current-price"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Change"}),a.jsx("div",{className:`chart-stat-value ${(()=>{const t=z(),r=t[t.length-1]?.close,l=t[t.length-2]?.close;return r&&l?r>l?"text-green-600":"text-red-600":"text-gray-600"})()}`,children:(()=>{const t=z(),r=t[t.length-1]?.close,l=t[t.length-2]?.close;if(r&&l){const d=r-l,s=d/l*100;return`${d>=0?"+":""}${d.toFixed(2)} (${s>=0?"+":""}${s.toFixed(2)}%)`}return"N/A"})()})]},"change"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Range"}),a.jsx("div",{className:"chart-stat-value",children:(()=>{const r=z().map(s=>s.close);if(r.length===0)return"N/A";const l=Math.max(...r);return`${Math.min(...r).toFixed(2)} - ${l.toFixed(2)}`})()})]},"range"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Last Wedge"}),a.jsx("div",{className:"chart-stat-value",children:(()=>{const t=Q();if(!t)return"None";let r;if(typeof t.date=="string")if(t.date.includes(",")){const[s,h,k]=t.date.split(",");r=`${s}-${h.padStart(2,"0")}-${k.padStart(2,"0")}`}else r=t.date;else r=new Date(t.date).toISOString().split("T")[0];const l=t.status==="pop"?"text-green-600":"text-red-600",d=t.status.toUpperCase();return a.jsxs("span",{children:[a.jsx("span",{className:"text-gray-400 text-xs",children:r}),a.jsx("br",{}),a.jsx("span",{className:l,children:d})]})})()})]},"last-wedge"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label",children:"Date Stats"}),a.jsx("div",{className:"chart-stat-value",children:(()=>{if(!D)return"N/A";const t=u.find(l=>l.date===D);if(!t)return"N/A";const r=`${D.substring(0,4)}-${D.substring(4,6)}-${D.substring(6,8)}`;return a.jsxs("span",{children:[a.jsx("span",{className:"text-gray-400 text-xs",children:r}),a.jsx("br",{}),a.jsxs("span",{className:"text-blue-600",children:[t.pop.length,"P/",t.drop.length,"D"]})]})})()})]},"date-stats")]})}),a.jsx("div",{className:"mt-1",children:R&&a.jsx(q,{highcharts:W,options:R,constructorType:"stockChart"})}),a.jsx("div",{className:"mt-4",children:G&&a.jsx(q,{highcharts:W,options:G,constructorType:"stockChart"})})]})};export{ge as default};
