import{r as b,j as a}from"./query-vendor-Du5i0pT7.js";import{d as q,H as W,L as te,a as J}from"./index-BZMNCRrJ.js";import{E as ae}from"./ErrorMessage-B58T-2Vz.js";import"./react-vendor-DJG_os-6.js";import"./charts-vendor-CIWdG-YD.js";import"./utils-vendor-BnbtjNgs.js";const $=(C,E)=>{const v=[],x=2/(E+1);let S=0;for(let u=0;u<E&&u<C.length;u++)S+=C[u];v[E-1]=S/E;for(let u=E;u<C.length;u++)v[u]=C[u]*x+v[u-1]*(1-x);return v},re=(C,E=10,v=20,x=5)=>{const S=$(C,E),u=$(C,v),T=[],F=[],j=[];for(let f=Math.max(E,v)-1;f<C.length;f++)T[f]=S[f]-u[f];const A=$(T.filter(f=>f!==void 0),x);let z=0;for(let f=Math.max(E,v)-1;f<C.length;f++)T[f]!==void 0&&(F[f]=A[z],j[f]=T[f]-F[f],z++);return{macdLine:T,signalLine:F,histogram:j}},ge=({autoRefresh:C=!1,refreshInterval:E=60*60*1e3,className:v=""})=>{const[x,S]=b.useState(""),[u,T]=b.useState([]),[F,j]=b.useState(""),[A,z]=b.useState("pop"),[f,K]=b.useState([]),[_,M]=b.useState(!0),[I,O]=b.useState(null),[B,R]=b.useState(null),P=b.useCallback(async()=>{try{M(!0),O(null);const t=await q.getWedgePopStats();if(!t||!Array.isArray(t))throw new Error("Invalid data format received");const n=t.sort((c,l)=>{const m=new Date(c.date.substring(0,4)+"-"+c.date.substring(4,6)+"-"+c.date.substring(6,8));return new Date(l.date.substring(0,4)+"-"+l.date.substring(4,6)+"-"+l.date.substring(6,8)).getTime()-m.getTime()}).map(c=>({date:c.date,pop:c.pop,drop:c.drop,pop_pct:c.pop_pct,drop_pct:c.drop_pct}));if(T(n),n.length>0){const c=n[0].date;j(c),n[0].pop.length>0?(S(n[0].pop[0]),z("pop")):n[0].drop.length>0&&(S(n[0].drop[0]),z("drop"))}}catch(t){console.error("Failed to fetch categorized tickers:",t),O("Failed to fetch categorized ticker list")}finally{M(!1)}},[]),V=b.useCallback(()=>{if(!F||!u.length)return[];const t=u.find(s=>s.date===F);return t?A==="pop"?t.pop:t.drop:[]},[F,A,u]),H=b.useCallback(async t=>{if(t)try{M(!0),O(null);const s=await q.getOHLCVW(t);if(!s||!Array.isArray(s))throw new Error("Invalid OHLCV data format received");K(s)}catch(s){console.error("Failed to fetch OHLCV data:",s),O("Failed to fetch OHLCV data")}finally{M(!1)}},[]);b.useEffect(()=>{P()},[P]),b.useEffect(()=>{x&&H(x)},[x,H]),b.useEffect(()=>{if(!C)return;const t=setInterval(()=>{x&&H(x)},E);return()=>clearInterval(t)},[C,E,x,H]),b.useEffect(()=>{const t=V();t.length>0?S(t[0]):S("")},[F,A,V]);const y=b.useMemo(()=>{if(!f.length)return null;const t=[...f].sort((e,r)=>{const o=new Date(e.trade_date.replace(/,/g,"-")),p=new Date(r.trade_date.replace(/,/g,"-"));return o.getTime()-p.getTime()}),s=t.map(e=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[o,p,h]=e.trade_date.split(",");r=new Date(Number(o),Number(p)-1,Number(h)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return[r,e.open,e.high,e.low,e.close]}),n=t.map(e=>e.close),c=$(n,10),l=$(n,20),m=re(n,10,20,5),k=t.map((e,r)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,h,w]=e.trade_date.split(",");o=new Date(Number(p),Number(h)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,c[r]||null]}).filter(e=>e[1]!==null),N=t.map((e,r)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,h,w]=e.trade_date.split(",");o=new Date(Number(p),Number(h)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,l[r]||null]}).filter(e=>e[1]!==null),d=t.map((e,r)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,h,w]=e.trade_date.split(",");o=new Date(Number(p),Number(h)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,m.macdLine[r]||null]}).filter(e=>e[1]!==null),i=t.map((e,r)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,h,w]=e.trade_date.split(",");o=new Date(Number(p),Number(h)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,m.signalLine[r]||null]}).filter(e=>e[1]!==null),D=t.map((e,r)=>{let o;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[p,h,w]=e.trade_date.split(",");o=new Date(Number(p),Number(h)-1,Number(w)).getTime()}else o=new Date(e.trade_date).getTime();else o=new Date(e.trade_date).getTime();return[o,m.histogram[r]||null]}).filter(e=>e[1]!==null),g=t.map(e=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[o,p,h]=e.trade_date.split(",");r=new Date(Number(o),Number(p)-1,Number(h)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return e.wedge_status==="pop"?{x:r,y:e.high,marker:{symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"POP",style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"},y:-20}}:e.wedge_status==="drop"?{x:r,y:e.low,marker:{symbol:"circle",fillColor:"#F92672",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#F92672",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"DROP",style:{color:"#F92672",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #F92672"},y:20}}:null}).filter(Boolean);return{candlestickData:s,wedgeMarkers:g,sortedData:t,ema10Data:k,ema20Data:N,macdLineData:d,signalLineData:i,histogramData:D,ema10:c,ema20:l,macdData:m}},[f]),Y=b.useMemo(()=>{if(!y)return null;const{candlestickData:t,wedgeMarkers:s,sortedData:n,ema10Data:c,ema20Data:l,macdLineData:m,signalLineData:k,histogramData:N}=y;return{chart:{type:"candlestick",height:650,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",panning:{enabled:!0,type:"x"},style:{fontFamily:"inherit"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1,spacing:[5,5,5,5],reflow:!0,events:{load:function(){},mouseOver:function(d){if(d.target&&d.target.series&&d.target.series.type==="candlestick"){const i=this,D=i.series.find(g=>g.name==="Wedge Status");if(D){const g=d.target.x;D.points.forEach(e=>{if(Math.abs(e.x-g)<24*60*60*1e3){const o=e.dataLabels?.text==="POP"?"#A6E22E":"#F92672";e.update({marker:{radius:12,lineWidth:0,fillColor:o,lineColor:"transparent",symbol:"circle"}},!1)}}),i.redraw()}}},mouseOut:function(d){if(d.target&&d.target.series&&d.target.series.type==="candlestick"){const i=this,D=i.series.find(g=>g.name==="Wedge Status");D&&(D.points.forEach(g=>{const r=g.dataLabels?.text==="POP"?"#A6E22E":"#F92672";g.update({marker:{radius:6,lineWidth:0,fillColor:r,lineColor:"transparent",symbol:"circle"}},!1)}),i.redraw())}},setExtremes:function(d){R({min:d.min,max:d.max})}}},title:{text:""},subtitle:{text:""},xAxis:{type:"datetime",labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},events:{setExtremes:function(d){R({min:d.min,max:d.max})}}},yAxis:[{type:"logarithmic",title:{text:"Price ($)",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},minorGridLineWidth:1,minorGridLineColor:"rgba(107, 114, 128, 0.2)",minorTickLength:3,minorTickColor:"rgba(156, 163, 175, 0.4)",minorTickWidth:1},{title:{text:"",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{enabled:!1},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,opposite:!0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},{title:{text:"MACD",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,top:"75%",height:"25%",offset:0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},plotLines:[{value:0,color:"#F8F8F2",width:3,dashStyle:"solid",zIndex:1,label:{text:"0",style:{color:"#F8F8F2",fontSize:"14px",fontWeight:"bold",textShadow:"0 0 3px rgba(0,0,0,0.8)"}}}]}],series:[{name:x,data:t,type:"candlestick",color:"#F92672",upColor:"#A6E22E",downColor:"#F92672",lineColor:"#F92672",upLineColor:"#A6E22E",downLineColor:"#F92672",zIndex:2,lineWidth:2,marker:{enabled:!1,states:{hover:{enabled:!0,radius:6,lineWidth:2,lineColor:"#F92672"}}},tooltip:{enabled:!0,pointFormat:""}},{name:"Volume",data:n.map(d=>{let i;if(typeof d.trade_date=="string")if(d.trade_date.includes(",")){const[D,g,e]=d.trade_date.split(",");i=new Date(Number(D),Number(g)-1,Number(e)).getTime()}else i=new Date(d.trade_date).getTime();else i=new Date(d.trade_date).getTime();return[i,d.volume]}),type:"column",yAxis:1,visible:!0,color:"#66D9EF",opacity:.6,zIndex:1},{name:"Wedge Status",data:s,type:"scatter",zIndex:10,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}",backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){const d=W.dateFormat("%Y-%m-%d",this.x),i=this.point.dataLabels?.text||"Wedge";return`<div style="padding: 4px 0;"><b style="color: ${i==="POP"?"#A6E22E":"#F92672"}; font-size: 14px;">${i} - ${d}</b></div>`}},dataLabels:{enabled:!0,style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"}}},{name:"EMA10",data:c,type:"line",color:"#FD971F",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"EMA20",data:l,type:"line",color:"#66D9EF",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:m,type:"line",color:"#A6E22E",lineWidth:2,yAxis:2,zIndex:1,visible:!1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:k,type:"line",color:"#F92672",lineWidth:2,yAxis:2,zIndex:1,visible:!1,linkedTo:":previous",marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:N,type:"column",color:"#75715E",opacity:.6,yAxis:2,zIndex:0,visible:!1,linkedTo:":previous",tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}}],tooltip:{shared:!1,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let i=`<div style="padding: 4px 0;"><b style="color: #F92672; font-size: 14px;">${W.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;const D=this.x;let g=null;if(g=n.find(e=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[o,p,h]=e.trade_date.split(",");r=new Date(Number(o),Number(p)-1,Number(h)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return r===D}),!g){const e=W.dateFormat("%Y-%m-%d",D);g=n.find(r=>{let o;if(typeof r.trade_date=="string")if(r.trade_date.includes(",")){const[p,h,w]=r.trade_date.split(","),X=new Date(Number(p),Number(h)-1,Number(w));o=W.dateFormat("%Y-%m-%d",X.getTime())}else{const p=new Date(r.trade_date);o=W.dateFormat("%Y-%m-%d",p.getTime())}else{const p=new Date(r.trade_date);o=W.dateFormat("%Y-%m-%d",p.getTime())}return o===e})}if(g){if(i+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.open?.toFixed(2)}</span><br/>`,i+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.high?.toFixed(2)}</span><br/>`,i+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.low?.toFixed(2)}</span><br/>`,i+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${g.close?.toFixed(2)}</span><br/>`,i+=`<span style="color: #75715E; font-size: 16px;">●</span> <span style="color: #75715E; font-weight: 500;">Volume:</span> <span style="color: #F8F8F2; font-weight: bold;">${g.volume?.toLocaleString()}</span><br/>`,g.wedge_status&&g.wedge_status!=="none"){const r=g.wedge_status==="pop"?"#A6E22E":"#F92672",o=g.wedge_status==="pop"?"POP":"DROP";i+=`<span style="color: ${r}; font-size: 16px;">●</span> <span style="color: ${r}; font-weight: 500;">Wedge Status:</span> <span style="color: ${r}; font-weight: bold;">${o}</span><br/>`}const e=n.findIndex(r=>{let o;if(typeof r.trade_date=="string")if(r.trade_date.includes(",")){const[p,h,w]=r.trade_date.split(",");o=new Date(Number(p),Number(h)-1,Number(w)).getTime()}else o=new Date(r.trade_date).getTime();else o=new Date(r.trade_date).getTime();return o===D});e>=0&&e<y.ema10.length&&y.ema10[e]&&(i+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">EMA10:</span> <span style="color: #F8F8F2; font-weight: bold;">$${y.ema10[e].toFixed(2)}</span><br/>`),e>=0&&e<y.ema20.length&&y.ema20[e]&&(i+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">EMA20:</span> <span style="color: #F8F8F2; font-weight: bold;">$${y.ema20[e].toFixed(2)}</span><br/>`)}else if(this.points&&this.points.length>0){const e=this.points[0];e.series.type==="candlestick"&&e.open!==void 0&&(i+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.open?.toFixed(2)}</span><br/>`,i+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.high?.toFixed(2)}</span><br/>`,i+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.low?.toFixed(2)}</span><br/>`,i+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.close?.toFixed(2)}</span><br/>`)}return this.points?.forEach(e=>{const r=e.series.name;let o=e.y?.toFixed(2);const p=r===x,h=r==="Wedge Status";if(p||r==="Volume"||r==="EMA10"||r==="EMA20"||r==="MACD")return;let U="#75715E",Z="#F8F8F2",ee="●";h&&(U="#A6E22E",Z="#A6E22E"),i+=`<span style="color:${e.color}; font-size: 16px;">${ee}</span> <span style="color: ${U}; font-weight: 500;">${r}</span>: <span style="color: ${Z}; font-weight: bold;">${o}</span><br/>`}),i}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"14px",color:"#F8F8F2",fontWeight:"600"},itemHoverStyle:{color:"#F92672"},symbolHeight:12,symbolWidth:24,symbolRadius:3,backgroundColor:"#272822",borderWidth:1,borderColor:"#75715E",borderRadius:8,shadow:!0,itemDistance:20,padding:12,width:"100%",height:50,itemWidth:150,useHTML:!1,floating:!1,x:0,y:0},plotOptions:{candlestick:{color:"#F92672",upColor:"#A6E22E",lineColor:"#F92672",upLineColor:"#A6E22E",tooltip:{enabled:!0}},column:{color:"#66D9EF",opacity:.6},series:{animation:{duration:1e3},tooltip:{enabled:!0}}},navigator:{enabled:!0,height:40,margin:10,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)",lineColor:"rgba(96, 165, 250, 0.5)",rifleColor:"rgba(96, 165, 250, 0.8)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.4)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"10px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:8,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"12px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:3,text:"3y"},{type:"year",count:5,text:"5y"},{type:"all",text:"All"}]},responsive:{rules:[{condition:{maxWidth:768},chartOptions:{legend:{enabled:!1},chart:{height:400}}}]},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:14,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)",states:{hover:{fill:"rgba(55, 65, 81, 0.95)",style:{color:"#ffffff"}}}}}}}}},[y,x]),G=b.useMemo(()=>{if(!u.length)return null;const t=[...u].sort((l,m)=>{const k=new Date(l.date.substring(0,4)+"-"+l.date.substring(4,6)+"-"+l.date.substring(6,8)),N=new Date(m.date.substring(0,4)+"-"+m.date.substring(4,6)+"-"+m.date.substring(6,8));return k.getTime()-N.getTime()}),s=t.map(l=>[new Date(l.date.substring(0,4)+"-"+l.date.substring(4,6)+"-"+l.date.substring(6,8)).getTime(),l.pop.length]),n=t.map(l=>[new Date(l.date.substring(0,4)+"-"+l.date.substring(4,6)+"-"+l.date.substring(6,8)).getTime(),l.drop.length]),c=t.map(l=>[new Date(l.date.substring(0,4)+"-"+l.date.substring(4,6)+"-"+l.date.substring(6,8)).getTime(),l.pop.length+l.drop.length]);return{chart:{type:"area",height:400,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",panning:{enabled:!0,type:"x"},style:{fontFamily:"inherit"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1,spacing:[5,5,5,5],reflow:!0},title:{text:"Wedge Statistics",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"},align:"left",x:10,y:8},xAxis:{type:"datetime",labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"},rotation:0,step:2},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},yAxis:{title:{text:"Number of Events",style:{fontSize:"14px",fontWeight:"700",color:"#E5E7EB"}},labels:{style:{fontSize:"12px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:1,gridLineColor:"rgba(107, 114, 128, 0.3)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:1,tickLength:4,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:1,dashStyle:"shortdot"}},series:[{name:"DROP Events",data:n,type:"areaspline",color:"#F92672",fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(249, 38, 114, 0.8)"],[1,"rgba(249, 38, 114, 0.1)"]]},lineColor:"#F92672",lineWidth:2,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y} events"}},{name:"POP Events",data:s,type:"areaspline",color:"#A6E22E",fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"rgba(166, 226, 46, 0.8)"],[1,"rgba(166, 226, 46, 0.1)"]]},lineColor:"#A6E22E",lineWidth:2,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y} events"}},{name:"Total Events",data:c,type:"spline",color:"#66D9EF",lineWidth:3,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y} events"},zIndex:10}],tooltip:{shared:!0,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let m=`<div style="padding: 4px 0;"><b style="color: #F92672; font-size: 14px;">${W.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;return this.points?.forEach(k=>{const N=k.series.name,d=k.y;let i="#75715E";N.includes("POP")?i="#A6E22E":N.includes("DROP")?i="#F92672":N.includes("Total")&&(i="#66D9EF"),m+=`<span style="color: ${i}; font-size: 16px;">●</span> <span style="color: ${i}; font-weight: 500;">${N}:</span> <span style="color: #F8F8F2; font-weight: bold;">${d}</span><br/>`}),m}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"12px",color:"#F8F8F2",fontWeight:"600"},itemHoverStyle:{color:"#F92672"},symbolHeight:10,symbolWidth:20,symbolRadius:2,backgroundColor:"#272822",borderWidth:1,borderColor:"#75715E",borderRadius:6,shadow:!0,itemDistance:15,padding:8,width:"100%",height:40,itemWidth:120,useHTML:!1,floating:!1,x:0,y:0},plotOptions:{area:{stacking:"normal",lineWidth:2,marker:{enabled:!0,radius:3,symbol:"circle",states:{hover:{enabled:!0,radius:5,brightness:.3}}},tooltip:{enabled:!0}},series:{animation:{duration:1e3},tooltip:{enabled:!0}}},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:6,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"11px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:3,text:"3y"},{type:"year",count:5,text:"5y"},{type:"all",text:"All"}]},navigator:{enabled:!0,height:30,margin:5,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)",lineColor:"rgba(96, 165, 250, 0.5)",rifleColor:"rgba(96, 165, 250, 0.8)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.3)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"9px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},responsive:{rules:[{condition:{maxWidth:768},chartOptions:{legend:{enabled:!1},chart:{height:200},rangeSelector:{enabled:!1},navigator:{enabled:!1},scrollbar:{enabled:!1}}}]},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:12,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)",states:{hover:{fill:"rgba(55, 65, 81, 0.95)",style:{color:"#ffffff"}}}}}}}}},[u]),L=b.useCallback(()=>y?.sortedData?B?y.sortedData.filter(t=>{let s;if(typeof t.trade_date=="string")if(t.trade_date.includes(",")){const[n,c,l]=t.trade_date.split(",");s=new Date(Number(n),Number(c)-1,Number(l)).getTime()}else s=new Date(t.trade_date).getTime();else s=new Date(t.trade_date).getTime();return s>=B.min&&s<=B.max}):y.sortedData:y?.sortedData||[],[y,B]),Q=b.useCallback(()=>{if(!y?.sortedData)return null;const t=L();if(t.length===0)return null;for(let s=t.length-1;s>=0;s--){const n=t[s];if(n.wedge_status&&n.wedge_status!=="none")return{date:n.trade_date,status:n.wedge_status}}return null},[y,L]);return _&&!f.length?a.jsx("div",{className:`chart-container ${v}`,children:a.jsx(te,{text:"Loading OHLCV data..."})}):I?a.jsxs("div",{className:`chart-container ${v}`,children:[a.jsx(ae,{message:`Error: ${I}`}),a.jsx("div",{className:"mt-4 text-center",children:a.jsx("button",{onClick:()=>P(),className:"btn-primary",disabled:_,children:_?"Refreshing...":"Retry"})})]}):a.jsxs("div",{className:`chart-container ${v}`,children:[a.jsx("div",{className:"chart-header py-1",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"chart-title text-lg",children:x||"OHLCV Chart"}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:["Date:",a.jsx("select",{value:F,onChange:t=>j(t.target.value),className:"input-field",disabled:_,children:u.length===0?a.jsx("option",{value:"",children:"No dates available"}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"",children:"Select a date"}),u.map(t=>a.jsxs("option",{value:t.date,children:[t.date.substring(0,4),"-",t.date.substring(4,6),"-",t.date.substring(6,8)]},t.date))]})})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:["Wedge Status:",a.jsxs("select",{value:A,onChange:t=>z(t.target.value),className:"input-field",disabled:_,children:[a.jsx("option",{value:"pop",children:"Pop"}),a.jsx("option",{value:"drop",children:"Drop"})]})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:["Ticker:",a.jsx("select",{value:x,onChange:t=>S(t.target.value),className:"input-field",disabled:_,children:(()=>{if(!F)return a.jsx("option",{value:"",children:"Select a date first"});const t=u.find(n=>n.date===F);if(!t)return a.jsx("option",{value:"",children:"No data for selected date"});const s=A==="pop"?t.pop:t.drop;return s.length===0?a.jsxs("option",{value:"",children:["No ",A," tickers"]}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"",children:"Select a ticker"}),s.map(n=>a.jsx("option",{value:n,children:n},n))]})})()})]}),a.jsx("button",{onClick:()=>P(),disabled:_,className:"btn-secondary text-xs",title:"Refresh data",children:_?a.jsx("div",{className:"loading-spinner w-4 h-4"}):"↻"})]})]})}),y&&a.jsx("div",{className:"chart-stats py-0.5",children:a.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label text-xs leading-tight",children:"Price"}),a.jsx("div",{className:"chart-stat-value text-sm leading-tight",children:(()=>{const t=L();return t.length===0?"N/A":`$${t[t.length-1].close.toFixed(2)}`})()})]},"price"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label text-xs leading-tight",children:"Change"}),a.jsx("div",{className:"chart-stat-value text-sm leading-tight",children:(()=>{const t=L();if(t.length<2)return"N/A";const s=t[t.length-1].close,n=t[t.length-2].close,c=s-n,l=c/n*100;return`${c>=0?"+":""}${c.toFixed(2)} (${l>=0?"+":""}${l.toFixed(2)}%)`})()})]},"change"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label text-xs leading-tight",children:"Range"}),a.jsx("div",{className:"chart-stat-value text-sm leading-tight",children:(()=>{const s=L().map(l=>l.close);if(s.length===0)return"N/A";const n=Math.max(...s);return`${Math.min(...s).toFixed(2)} - ${n.toFixed(2)}`})()})]},"range"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label text-xs leading-tight",children:"Last Wedge"}),a.jsx("div",{className:"chart-stat-value text-sm leading-tight",children:(()=>{const t=Q();if(!t)return"None";let s;if(typeof t.date=="string")if(t.date.includes(",")){const[l,m,k]=t.date.split(",");s=`${l}-${m.padStart(2,"0")}-${k.padStart(2,"0")}`}else s=t.date;else s=new Date(t.date).toISOString().split("T")[0];const n=t.status==="pop"?"text-success-400":"text-danger-400",c=t.status.toUpperCase();return a.jsxs("span",{children:[a.jsx("span",{className:"text-text-tertiary text-xs",children:s}),a.jsx("br",{}),a.jsx("span",{className:n,children:c})]})})()})]},"last-wedge"),a.jsxs("div",{className:"chart-stat",children:[a.jsx("div",{className:"chart-stat-label text-xs leading-tight",children:"Date Stats"}),a.jsx("div",{className:"chart-stat-value text-sm leading-tight",children:(()=>{if(!F)return"N/A";const t=u.find(n=>n.date===F);if(!t)return"N/A";const s=`${F.substring(0,4)}-${F.substring(4,6)}-${F.substring(6,8)}`;return a.jsxs("span",{children:[a.jsx("span",{className:"text-text-tertiary text-xs",children:s}),a.jsx("br",{}),a.jsxs("span",{className:"text-primary-400",children:[t.pop.length,"P/",t.drop.length,"D"]})]})})()})]},"date-stats")]})}),a.jsx("div",{className:"mt-1",children:Y&&a.jsx(J,{highcharts:W,options:Y,constructorType:"stockChart"})}),a.jsx("div",{className:"mt-4",children:G&&a.jsx(J,{highcharts:W,options:G,constructorType:"stockChart"})})]})};export{ge as default};
