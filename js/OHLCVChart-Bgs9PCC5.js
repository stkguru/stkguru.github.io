import{r as b,j as n}from"./query-vendor-Du5i0pT7.js";import{H as S,E as U,a as Z}from"./ErrorMessage-Cc20MXJj.js";import{L as q}from"./index-FRF0xT9i.js";import"./react-vendor-DJG_os-6.js";import"./charts-vendor-CIWdG-YD.js";const $=(w,D)=>{const C=[],g=2/(D+1);let N=0;for(let m=0;m<D&&m<w.length;m++)N+=w[m];C[D-1]=N/D;for(let m=D;m<w.length;m++)C[m]=w[m]*g+C[m-1]*(1-g);return C},J=(w,D=10,C=20,g=5)=>{const N=$(w,D),m=$(w,C),_=[],v=[],W=[];for(let u=Math.max(D,C)-1;u<w.length;u++)_[u]=N[u]-m[u];const k=$(_.filter(u=>u!==void 0),g);let A=0;for(let u=Math.max(D,C)-1;u<w.length;u++)_[u]!==void 0&&(v[u]=k[A],W[u]=_[u]-v[u],A++);return{macdLine:_,signalLine:v,histogram:W}},re=({autoRefresh:w=!1,refreshInterval:D=5*60*1e3,className:C=""})=>{const[g,N]=b.useState(""),[m,_]=b.useState([]),[v,W]=b.useState([]),[k,A]=b.useState(!0),[u,j]=b.useState(null),[z,V]=b.useState(null),O=b.useCallback(async()=>{try{A(!0),j(null),console.log("Fetching tickers from /api/wedge_pop/wedges.json");const t=await fetch("/api/wedge_pop/wedges.json");if(console.log("Response status:",t.status),!t.ok)throw new Error(`Failed to fetch tickers: ${t.status}`);const s=await t.json();console.log("Tickers data:",s);let o=[];Array.isArray(s)?o=s.map(i=>({ticker:i})):s&&typeof s=="object"&&(s.tickers?o=Array.isArray(s.tickers)?s.tickers.map(i=>({ticker:i})):[]:s.data?Array.isArray(s.data)?o=s.data.map(i=>({ticker:i})):o=[]:o=Object.keys(s).map(i=>({ticker:i}))),_(o),console.log("Processed tickers:",o),o.length>0&&!g&&N(o[0].ticker)}catch(t){console.error("Failed to fetch tickers:",t),j("Failed to fetch ticker list")}finally{A(!1)}},[g]),M=b.useCallback(async t=>{if(t)try{A(!0),j(null),console.log("Fetching OHLCV data for ticker:",t);const s=await fetch(`/api/ohlcvw/${t}.json`);if(console.log("OHLCV response status:",s.status),!s.ok)throw new Error(`Failed to fetch OHLCV data: ${s.status}`);const o=await s.json();console.log("OHLCV data:",o);let i=[];if(Array.isArray(o))i=o;else if(o&&typeof o=="object")if(o.data&&Array.isArray(o.data))i=o.data;else if(o.ohlcv&&Array.isArray(o.ohlcv))i=o.ohlcv;else{const y=Object.keys(o);for(const E of y)if(Array.isArray(o[E])){i=o[E];break}}W(i),console.log("Processed OHLCV data:",i)}catch(s){console.error("Failed to fetch OHLCV data:",s),j("Failed to fetch OHLCV data")}finally{A(!1)}},[]);b.useEffect(()=>{O()},[O]),b.useEffect(()=>{g&&M(g)},[g,M]),b.useEffect(()=>{if(!w)return;const t=setInterval(()=>{g&&M(g)},D);return()=>clearInterval(t)},[w,D,g,M]);const h=b.useMemo(()=>{if(console.log("Processing chart data, ohlcvData length:",v.length),!v.length)return console.log("No OHLCV data available"),null;console.log("Sample OHLCV data:",v[0]);const t=[...v].sort((e,a)=>{const r=new Date(e.trade_date.replace(/,/g,"-")),c=new Date(a.trade_date.replace(/,/g,"-"));return r.getTime()-c.getTime()});console.log("Sorted data length:",t.length);const s=t.map(e=>{let a;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[r,c,f]=e.trade_date.split(",");a=new Date(Number(r),Number(c)-1,Number(f)).getTime()}else a=new Date(e.trade_date).getTime();else a=new Date(e.trade_date).getTime();return[a,e.open,e.high,e.low,e.close]});console.log("Candlestick data length:",s.length);const o=t.map(e=>e.close),i=$(o,10),y=$(o,20),E=J(o,10,20,5),T=t.map((e,a)=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[c,f,F]=e.trade_date.split(",");r=new Date(Number(c),Number(f)-1,Number(F)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return[r,i[a]||null]}).filter(e=>e[1]!==null),P=t.map((e,a)=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[c,f,F]=e.trade_date.split(",");r=new Date(Number(c),Number(f)-1,Number(F)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return[r,y[a]||null]}).filter(e=>e[1]!==null),p=t.map((e,a)=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[c,f,F]=e.trade_date.split(",");r=new Date(Number(c),Number(f)-1,Number(F)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return[r,E.macdLine[a]||null]}).filter(e=>e[1]!==null),l=t.map((e,a)=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[c,f,F]=e.trade_date.split(",");r=new Date(Number(c),Number(f)-1,Number(F)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return[r,E.signalLine[a]||null]}).filter(e=>e[1]!==null),x=t.map((e,a)=>{let r;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[c,f,F]=e.trade_date.split(",");r=new Date(Number(c),Number(f)-1,Number(F)).getTime()}else r=new Date(e.trade_date).getTime();else r=new Date(e.trade_date).getTime();return[r,E.histogram[a]||null]}).filter(e=>e[1]!==null),d=t.map(e=>{let a;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[r,c,f]=e.trade_date.split(",");a=new Date(Number(r),Number(c)-1,Number(f)).getTime()}else a=new Date(e.trade_date).getTime();else a=new Date(e.trade_date).getTime();return e.wedge_status==="pop"?{x:a,y:e.high,marker:{symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"POP",style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"},y:-20}}:e.wedge_status==="drop"?{x:a,y:e.low,marker:{symbol:"circle",fillColor:"#F92672",lineColor:"transparent",lineWidth:0,radius:6,states:{hover:{enabled:!0,radius:10,fillColor:"#F92672",lineColor:"transparent",brightness:.5}}},dataLabels:{enabled:!0,format:"DROP",style:{color:"#F92672",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #F92672"},y:20}}:null}).filter(Boolean);return console.log("Wedge markers count:",d.length),{candlestickData:s,wedgeMarkers:d,sortedData:t,ema10Data:T,ema20Data:P,macdLineData:p,signalLineData:l,histogramData:x,ema10:i,ema20:y,macdData:E}},[v]),H=b.useMemo(()=>{if(!h)return null;const{candlestickData:t,wedgeMarkers:s,sortedData:o,ema10Data:i,ema20Data:y,macdLineData:E,signalLineData:T,histogramData:P}=h;return{chart:{type:"candlestick",height:650,backgroundColor:"rgba(0, 0, 0, 0.3)",zoomType:"x",panning:{enabled:!0,type:"x"},style:{fontFamily:"inherit"},plotBackgroundColor:"rgba(0, 0, 0, 0.2)",plotBorderWidth:0,plotShadow:!1,spacing:[5,5,5,5],reflow:!0,events:{load:function(){},mouseOver:function(p){if(p.target&&p.target.series&&p.target.series.type==="candlestick"){const l=this,x=l.series.find(d=>d.name==="Wedge Status");if(x){const d=p.target.x;x.points.forEach(e=>{if(Math.abs(e.x-d)<24*60*60*1e3){const r=e.dataLabels?.text==="POP"?"#A6E22E":"#F92672";e.update({marker:{radius:12,lineWidth:0,fillColor:r,lineColor:"transparent",symbol:"circle"}},!1)}}),l.redraw()}}},mouseOut:function(p){if(p.target&&p.target.series&&p.target.series.type==="candlestick"){const l=this,x=l.series.find(d=>d.name==="Wedge Status");x&&(x.points.forEach(d=>{const a=d.dataLabels?.text==="POP"?"#A6E22E":"#F92672";d.update({marker:{radius:6,lineWidth:0,fillColor:a,lineColor:"transparent",symbol:"circle"}},!1)}),l.redraw())}},setExtremes:function(p){V({min:p.min,max:p.max})}}},title:{text:""},subtitle:{text:""},xAxis:{type:"datetime",labels:{format:"{value:%Y-%m-%d}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},events:{setExtremes:function(p){V({min:p.min,max:p.max})}}},yAxis:[{title:{text:"Price ($)",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},{title:{text:"",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{enabled:!1},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,opposite:!0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"}},{title:{text:"MACD",style:{fontSize:"16px",fontWeight:"700",color:"#E5E7EB"}},labels:{format:"{value:.2f}",style:{fontSize:"14px",color:"#D1D5DB",fontWeight:"500"}},gridLineWidth:2,gridLineColor:"rgba(107, 114, 128, 0.4)",lineColor:"rgba(156, 163, 175, 0.6)",tickColor:"rgba(156, 163, 175, 0.6)",tickWidth:2,tickLength:6,top:"75%",height:"25%",offset:0,crosshair:{color:"rgba(96, 165, 250, 0.7)",width:2,dashStyle:"shortdot"},plotLines:[{value:0,color:"#F8F8F2",width:3,dashStyle:"solid",zIndex:1,label:{text:"0",style:{color:"#F8F8F2",fontSize:"14px",fontWeight:"bold",textShadow:"0 0 3px rgba(0,0,0,0.8)"}}}]}],series:[{name:g,data:t,type:"candlestick",color:"#F92672",upColor:"#A6E22E",downColor:"#F92672",lineColor:"#F92672",upLineColor:"#A6E22E",downLineColor:"#F92672",zIndex:2,lineWidth:2,marker:{enabled:!1,states:{hover:{enabled:!0,radius:6,lineWidth:2,lineColor:"#F92672"}}},tooltip:{enabled:!0,pointFormat:""}},{name:"Volume",data:o.map(p=>{let l;if(typeof p.trade_date=="string")if(p.trade_date.includes(",")){const[x,d,e]=p.trade_date.split(",");l=new Date(Number(x),Number(d)-1,Number(e)).getTime()}else l=new Date(p.trade_date).getTime();else l=new Date(p.trade_date).getTime();return[l,p.volume]}),type:"column",yAxis:1,visible:!0,color:"#66D9EF",opacity:.6,zIndex:1},{name:"Wedge Status",data:s,type:"scatter",zIndex:10,marker:{enabled:!0,radius:6,symbol:"circle",fillColor:"#A6E22E",lineColor:"transparent",lineWidth:0,states:{hover:{enabled:!0,radius:10,fillColor:"#A6E22E",lineColor:"transparent",brightness:.5}}},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}",backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){const p=S.dateFormat("%Y-%m-%d",this.x),l=this.point.dataLabels?.text||"Wedge";return`<div style="padding: 4px 0;"><b style="color: ${l==="POP"?"#A6E22E":"#F92672"}; font-size: 14px;">${l} - ${p}</b></div>`}},dataLabels:{enabled:!0,style:{color:"#A6E22E",fontSize:"9px",fontWeight:"bold",textOutline:"none",textShadow:"0 0 3px #A6E22E"}}},{name:"EMA10",data:i,type:"line",color:"#FD971F",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"EMA20",data:y,type:"line",color:"#66D9EF",lineWidth:2,zIndex:1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:E,type:"line",color:"#A6E22E",lineWidth:2,yAxis:2,zIndex:1,visible:!1,marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:T,type:"line",color:"#F92672",lineWidth:2,yAxis:2,zIndex:1,visible:!1,linkedTo:":previous",marker:{enabled:!1},tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}},{name:"MACD",data:P,type:"column",color:"#75715E",opacity:.6,yAxis:2,zIndex:0,visible:!1,linkedTo:":previous",tooltip:{pointFormat:"{point.series.name}: {point.y:.2f}"}}],tooltip:{shared:!1,backgroundColor:"rgba(17, 24, 39, 0.98)",borderWidth:0,shadow:!0,borderRadius:8,style:{fontSize:"13px",color:"#ffffff"},formatter:function(){let l=`<div style="padding: 4px 0;"><b style="color: #F92672; font-size: 14px;">${S.dateFormat("%Y-%m-%d",this.x)}</b></div><br/>`;const x=this.x;let d=null;if(d=o.find(e=>{let a;if(typeof e.trade_date=="string")if(e.trade_date.includes(",")){const[r,c,f]=e.trade_date.split(",");a=new Date(Number(r),Number(c)-1,Number(f)).getTime()}else a=new Date(e.trade_date).getTime();else a=new Date(e.trade_date).getTime();return a===x}),!d){const e=S.dateFormat("%Y-%m-%d",x);d=o.find(a=>{let r;if(typeof a.trade_date=="string")if(a.trade_date.includes(",")){const[c,f,F]=a.trade_date.split(","),B=new Date(Number(c),Number(f)-1,Number(F));r=S.dateFormat("%Y-%m-%d",B.getTime())}else{const c=new Date(a.trade_date);r=S.dateFormat("%Y-%m-%d",c.getTime())}else{const c=new Date(a.trade_date);r=S.dateFormat("%Y-%m-%d",c.getTime())}return r===e})}if(d){if(l+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${d.open?.toFixed(2)}</span><br/>`,l+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${d.high?.toFixed(2)}</span><br/>`,l+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${d.low?.toFixed(2)}</span><br/>`,l+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${d.close?.toFixed(2)}</span><br/>`,l+=`<span style="color: #75715E; font-size: 16px;">●</span> <span style="color: #75715E; font-weight: 500;">Volume:</span> <span style="color: #F8F8F2; font-weight: bold;">${d.volume?.toLocaleString()}</span><br/>`,d.wedge_status&&d.wedge_status!=="none"){const a=d.wedge_status==="pop"?"#A6E22E":"#F92672",r=d.wedge_status==="pop"?"POP":"DROP";l+=`<span style="color: ${a}; font-size: 16px;">●</span> <span style="color: ${a}; font-weight: 500;">Wedge Status:</span> <span style="color: ${a}; font-weight: bold;">${r}</span><br/>`}const e=o.findIndex(a=>{let r;if(typeof a.trade_date=="string")if(a.trade_date.includes(",")){const[c,f,F]=a.trade_date.split(",");r=new Date(Number(c),Number(f)-1,Number(F)).getTime()}else r=new Date(a.trade_date).getTime();else r=new Date(a.trade_date).getTime();return r===x});e>=0&&e<h.ema10.length&&h.ema10[e]&&(l+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">EMA10:</span> <span style="color: #F8F8F2; font-weight: bold;">$${h.ema10[e].toFixed(2)}</span><br/>`),e>=0&&e<h.ema20.length&&h.ema20[e]&&(l+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">EMA20:</span> <span style="color: #F8F8F2; font-weight: bold;">$${h.ema20[e].toFixed(2)}</span><br/>`)}else if(this.points&&this.points.length>0){const e=this.points[0];e.series.type==="candlestick"&&e.open!==void 0&&(l+=`<span style="color: #A6E22E; font-size: 16px;">●</span> <span style="color: #A6E22E; font-weight: 500;">Open:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.open?.toFixed(2)}</span><br/>`,l+=`<span style="color: #FD971F; font-size: 16px;">●</span> <span style="color: #FD971F; font-weight: 500;">High:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.high?.toFixed(2)}</span><br/>`,l+=`<span style="color: #F92672; font-size: 16px;">●</span> <span style="color: #F92672; font-weight: 500;">Low:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.low?.toFixed(2)}</span><br/>`,l+=`<span style="color: #66D9EF; font-size: 16px;">●</span> <span style="color: #66D9EF; font-weight: 500;">Close:</span> <span style="color: #F8F8F2; font-weight: bold;">$${e.close?.toFixed(2)}</span><br/>`)}return this.points?.forEach(e=>{const a=e.series.name;let r=e.y?.toFixed(2);const c=a===g,f=a==="Wedge Status";if(c||a==="Volume"||a==="EMA10"||a==="EMA20"||a==="MACD")return;let I="#75715E",R="#F8F8F2",G="●";f&&(I="#A6E22E",R="#A6E22E"),l+=`<span style="color:${e.color}; font-size: 16px;">${G}</span> <span style="color: ${I}; font-weight: 500;">${a}</span>: <span style="color: ${R}; font-weight: bold;">${r}</span><br/>`}),l}},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",itemStyle:{fontSize:"14px",color:"#F8F8F2",fontWeight:"600"},itemHoverStyle:{color:"#F92672"},symbolHeight:12,symbolWidth:24,symbolRadius:3,backgroundColor:"#272822",borderWidth:1,borderColor:"#75715E",borderRadius:8,shadow:!0,itemDistance:20,padding:12,width:"100%",height:50,itemWidth:150,useHTML:!1,floating:!1,x:0,y:0},plotOptions:{candlestick:{color:"#F92672",upColor:"#A6E22E",lineColor:"#F92672",upLineColor:"#A6E22E",tooltip:{enabled:!0}},column:{color:"#66D9EF",opacity:.6},series:{animation:{duration:1e3},tooltip:{enabled:!0}}},navigator:{enabled:!0,height:40,margin:10,outlineWidth:0,outlineColor:"transparent",handles:{backgroundColor:"rgba(96, 165, 250, 0.8)",borderColor:"rgba(96, 165, 250, 1)",lineColor:"rgba(96, 165, 250, 0.5)",rifleColor:"rgba(96, 165, 250, 0.8)"},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.4)",lineColor:"rgba(75, 85, 99, 0.6)",tickColor:"rgba(75, 85, 99, 0.4)",labels:{style:{color:"#9ca3af",fontSize:"10px"}}}},scrollbar:{enabled:!0,barBackgroundColor:"rgba(75, 85, 99, 0.5)",barBorderColor:"rgba(75, 85, 99, 0.8)",buttonBackgroundColor:"rgba(55, 65, 81, 0.8)",buttonBorderColor:"rgba(75, 85, 99, 0.8)",buttonArrowColor:"#9ca3af",rifleColor:"rgba(96, 165, 250, 0.8)",trackBackgroundColor:"rgba(31, 41, 55, 0.3)",trackBorderColor:"rgba(75, 85, 99, 0.3)"},rangeSelector:{enabled:!0,selected:0,inputEnabled:!1,buttonTheme:{fill:"rgba(0, 0, 0, 0.9)",stroke:"rgba(75, 85, 99, 0.6)",r:8,states:{hover:{fill:"rgba(31, 41, 55, 0.9)",style:{color:"#ffffff"}},select:{fill:"rgba(96, 165, 250, 0.8)",style:{color:"#ffffff",fontWeight:"bold"}}},style:{color:"#9ca3af",fontSize:"12px",fontWeight:"500"}},buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"year",count:3,text:"3y"},{type:"year",count:5,text:"5y"},{type:"all",text:"All"}]},responsive:{rules:[{condition:{maxWidth:768},chartOptions:{legend:{enabled:!1},chart:{height:400}}}]},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{symbol:"menu",symbolX:12,symbolY:10,symbolSize:14,symbolStrokeWidth:2,symbolStroke:"#9ca3af",symbolFill:"rgba(31, 41, 55, 0.8)",menuItems:["downloadPNG","downloadPDF","downloadCSV"],theme:{fill:"rgba(31, 41, 55, 0.95)",stroke:"rgba(75, 85, 99, 0.5)",states:{hover:{fill:"rgba(55, 65, 81, 0.95)",style:{color:"#ffffff"}}}}}}}}},[h,g]),Y=t=>{N(t.target.value)},L=b.useCallback(()=>h?.sortedData?z?h.sortedData.filter(t=>{let s;if(typeof t.trade_date=="string")if(t.trade_date.includes(",")){const[o,i,y]=t.trade_date.split(",");s=new Date(Number(o),Number(i)-1,Number(y)).getTime()}else s=new Date(t.trade_date).getTime();else s=new Date(t.trade_date).getTime();return s>=z.min&&s<=z.max}):h.sortedData:h?.sortedData||[],[h,z]),X=b.useCallback(()=>{if(!h?.sortedData)return null;const t=L();if(t.length===0)return null;for(let s=t.length-1;s>=0;s--){const o=t[s];if(o.wedge_status&&o.wedge_status!=="none")return{date:o.trade_date,status:o.wedge_status}}return null},[h,L]);return b.useEffect(()=>{console.log("Debug - tickers count:",m.length),console.log("Debug - selectedTicker:",g),console.log("Debug - chartData:",h),console.log("Debug - chartOptions:",H)},[m.length,g,h,H]),k&&!v.length?n.jsx("div",{className:`chart-container ${C}`,children:n.jsx(q,{text:"Loading OHLCV data..."})}):u?n.jsxs("div",{className:`chart-container ${C}`,children:[n.jsx(U,{message:`Error: ${u}`}),n.jsx("div",{className:"mt-4 text-center",children:n.jsx("button",{onClick:()=>O(),className:"btn-primary",disabled:k,children:k?"Refreshing...":"Retry"})})]}):n.jsxs("div",{className:`chart-container ${C}`,children:[n.jsxs("div",{className:"chart-header",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"chart-title",children:g?`${g} OHLCV Chart`:"OHLCV Chart"}),n.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:n.jsx("button",{onClick:()=>O(),disabled:k,className:"btn-secondary text-xs",title:"Refresh data",children:k?n.jsx("div",{className:"loading-spinner w-4 h-4"}):"↻"})})]}),n.jsx("div",{className:"chart-controls mt-2",children:n.jsx("div",{className:"flex items-center gap-6 flex-wrap",children:n.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:["Ticker:",n.jsx("select",{value:g,onChange:Y,className:"input-field",disabled:k,children:m.length===0?n.jsx("option",{value:"",children:"No tickers available"}):n.jsxs(n.Fragment,{children:[n.jsx("option",{value:"",children:"Select a ticker"}),m.map(t=>n.jsx("option",{value:t.ticker,children:t.ticker},t.ticker))]})})]})})})]}),h&&n.jsx("div",{className:"chart-stats py-1 px-3",children:n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"chart-stat",children:[n.jsx("div",{className:"chart-stat-label",children:"Current Price"}),n.jsxs("div",{className:"chart-stat-value",children:["$",(()=>{const t=L();return t[t.length-1]?.close?.toFixed(2)||"N/A"})()]})]},"current-price"),n.jsxs("div",{className:"chart-stat",children:[n.jsx("div",{className:"chart-stat-label",children:"Change"}),n.jsx("div",{className:`chart-stat-value ${(()=>{const t=L(),s=t[t.length-1]?.close,o=t[t.length-2]?.close;return s&&o?s>o?"text-green-600":"text-red-600":"text-gray-600"})()}`,children:(()=>{const t=L(),s=t[t.length-1]?.close,o=t[t.length-2]?.close;if(s&&o){const i=s-o,y=i/o*100;return`${i>=0?"+":""}${i.toFixed(2)} (${y>=0?"+":""}${y.toFixed(2)}%)`}return"N/A"})()})]},"change"),n.jsxs("div",{className:"chart-stat",children:[n.jsx("div",{className:"chart-stat-label",children:"Range"}),n.jsx("div",{className:"chart-stat-value",children:(()=>{const s=L().map(y=>y.close);if(s.length===0)return"N/A";const o=Math.max(...s);return`${Math.min(...s).toFixed(2)} - ${o.toFixed(2)}`})()})]},"range"),n.jsxs("div",{className:"chart-stat",children:[n.jsx("div",{className:"chart-stat-label",children:"Last Wedge"}),n.jsx("div",{className:"chart-stat-value",children:(()=>{const t=X();if(!t)return"None";let s;if(typeof t.date=="string")if(t.date.includes(",")){const[y,E,T]=t.date.split(",");s=`${y}-${E.padStart(2,"0")}-${T.padStart(2,"0")}`}else s=t.date;else s=new Date(t.date).toISOString().split("T")[0];const o=t.status==="pop"?"text-green-600":"text-red-600",i=t.status.toUpperCase();return n.jsxs("span",{children:[n.jsx("span",{className:"text-gray-400 text-xs",children:s}),n.jsx("br",{}),n.jsx("span",{className:o,children:i})]})})()})]},"last-wedge")]})}),n.jsx("div",{className:"mt-1",children:H&&n.jsx(Z,{highcharts:S,options:H,constructorType:"stockChart"})})]})};export{re as default};
